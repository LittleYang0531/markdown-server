# T2 æ¨¡æ£±ä¸¤å¯ (ambiguous)

## é¢˜ç›®æè¿° 

ç»™å®šä¸€ä¸ªåºåˆ— $a_1, a_2, ..., a_n$ï¼Œæ¯æ¬¡è¯¢é—®ä¸€ä¸ªåŒºé—´ $[l, r]$ å†…å‡ºç°æœ€å¤šçš„æ•°çš„å‡ºç°æ¬¡æ•°ã€‚

ä½†ä»Šå¤©æˆ‘ä»¬ä¸å¤ªå…³å¿ƒé—®é¢˜çš„ç²¾ç¡®ç­”æ¡ˆï¼Œåªå…³å¿ƒé—®é¢˜çš„æ•°é‡çº§ã€‚å› æ­¤ï¼Œå¦‚æœç²¾ç¡®ç­”æ¡ˆæ˜¯ $ans$ï¼Œä½ çš„
å›ç­”åªè¦åœ¨ $[0.5ans, 2ans]$ å†…å°±ç®—ä½ å¯¹ã€‚

## é¢˜ç›®åˆ†æ

å¯¹äºé¢œè‰² $ğ‘$, è®¾å…¶å‡ºç°çš„ä½ç½®åˆ†åˆ«ä¸º $ğ‘_1, ğ‘_2, ... , ğ‘_ğ‘š$, æˆ‘ä»¬è€ƒè™‘å¯¹äºæ‰€æœ‰é•¿åº¦ $l = 1, a, a^2, ...$ è¿›è¡Œæ£€æŸ¥, ä¹Ÿå³å¯¹äº $ğ‘— âˆ’ ğ‘– + 1 = ğ‘™$ çš„çº¿æ®µ $[ğ‘_ğ‘–, ğ‘_ğ‘—]$, å¯¹äºæ¯ä¸ªè¯¢é—®, æˆ‘ä»¬åªæ£€æŸ¥å…¶åŒ…å«çš„çº¿æ®µä¸­ $ğ‘™$ çš„æœ€å¤§å€¼. å¦‚æœè¿™ä¸ªç­”æ¡ˆä¸º $ğ‘¥$, è¯´æ˜ç²¾ç¡®ç­”æ¡ˆåœ¨ $[ğ‘¥, ağ‘¥)$ ä¹‹é—´, å– $a = 4$, æˆ‘ä»¬è¾“å‡º $2ğ‘¥$ å³å¯. å®¹æ˜“åšåˆ° $\mathcal{ğ‘‚}((ğ‘› + ğ‘) \log ğ‘›)$. (å…¶å®ä¹Ÿèƒ½åšåˆ° $\mathcal{ğ‘‚}((ğ‘› + ğ‘) log log ğ‘›)$, è¯»è€…å¯ä»¥è‡ªè¡Œæ€è€ƒ.)

## å‚è€ƒä»£ç 

```cpp
#include<bits/stdc++.h>
using namespace std;
typedef long long van;
template<typename T> inline
void read(T& x, int jz = 10) {
    T f = 1, b = 0; char ch = getchar();
    while (!isdigit(ch)) {
        if (ch == '-') f = -1;
        ch = getchar();
    } while (isdigit(ch))
        b *= jz, b += ch - '0', ch = getchar();
    x = f * b; return;
}
template<typename T> inline
void print(T x, int jz = 10) {
    if (x == 0) return putchar('0'), void();
    if (x < 0) putchar('-'), x = -x;
    int st[129] = {0}, k = 0;
    while (x) st[++k] = x % jz, x /= jz;
    for (int i = k; i; i--) putchar(st[i] + '0');
} const van MaxN = 1e6 + 10;
van n, Q, a[MaxN], L[MaxN], R[MaxN];
vector<van> wh[MaxN];
van nowlen[MaxN];
vector<van> qid[MaxN];
van maxl[MaxN], ans[MaxN];
int main() {
    read(n), read(Q);
    for (int i = 1; i <= n; i++) {
        read(a[i]); wh[a[i]].push_back(i);
        nowlen[i] = wh[a[i]].size();
    }
    for (int i = 1; i <= Q; i++) {
        read(L[i]), read(R[i]);
        qid[R[i]].push_back(i);
    }
    for (int r = 1; r <= n; r++) { // æšä¸¾å³ç«¯ç‚¹
        for (int num = 1; num <= nowlen[r]; num *= 4) { // æšä¸¾æ•°ä¸ªæ•°
            van l = wh[a[r]][nowlen[r] - num];
            maxl[num] = max(maxl[num], l);
        }
        for (int i = 0; i < qid[r].size(); i++) {
            van l = L[qid[r][i]], num = 1 << 18;
            while (maxl[num] < l) num /= 4;
            ans[qid[r][i]] = num * 2;
        }
    }
    for (int i = 1; i <= Q; i++) print(ans[i]), putchar('\n');
}
```
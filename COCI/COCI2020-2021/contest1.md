[pixiv: 92771524]: # 'https://cdn.jsdelivr.net/gh/LittleYang0531/image/blog/cover/92771524_p0_master1200.jpg'

# COCI2020-2021#1 åšé¢˜è®°å½•

## T1 Patkice

### é¢˜ç›®æè¿°:

â€‹ä¸æ˜¯å¾ˆä¹…ä¹‹å‰ï¼Œåœ¨ä¸€ä¸ªé¥è¿œçš„å¤§é™†ä¸Šï¼Œä½ç€ä¸‰åªæ©¡çš®é¸­ã€‚åœ¨ä¸€ä¸ªç‚çƒ­çš„å¤æ—¥ï¼Œèººåœ¨æ²™æ»©ä¸Šçš„é¸­å­ä»¬å†³å®šæ—…è¡Œåˆ°ä¸€åº§ç›¸é‚»çš„å°å²›(ç”¨ä¸€æŠŠè€æ—§çš„é»‘è‰²é›¨ä¼)ã€‚

â€‹é¸­å­ä»¬æ˜¯ç»éªŒä¸°å¯Œçš„æµ·æ´‹æ¢é™©å®¶ï¼Œåœ¨æ—…è¡Œä¹‹å‰ï¼Œä»–ä»¬ä¼šæ£€æŸ¥å½“å‰æµ·æ´‹çš„æµ·å›¾ã€‚åœ¨æµ·å›¾ä¸Šï¼Œé¸­å­ä»¬ç›®å‰å±…ä½çš„å²›å±¿è¢«å­—ç¬¦ `o` æ ‡è®°ï¼Œé¸­å­ä»¬å¯ä»¥æœä¸œ(E)å—(S)è¥¿(W)åŒ—(N)ä¸­çš„ä»»æ„æ–¹å‘å¼€å§‹ä»–ä»¬çš„æ—…é€”ã€‚

â€‹æµ·æ´‹ä¸­çš„æ´‹æµä¼šåƒå››ä¸ªæ–¹å‘ç§»åŠ¨ï¼Œåœ¨æµ·å›¾ä¸Šï¼Œå‘ä¸œçš„æ´‹æµè¢«æ ‡è®°ä¸º `>`ï¼Œå‘è¥¿çš„æ´‹æµè¢«æ ‡è®°ä¸º `<`ï¼Œå‘åŒ—çš„æ´‹æµè¢«æ ‡è®°ä¸º `^`ï¼Œå‘å—çš„æ´‹æµè¢«æ ‡è®°ä¸º `v`ã€‚å½“é¸­å­ä»¬ä½äºæ´‹æµä¸­çš„æŸä¸€ä¸ªä½ç½®æ—¶ï¼Œä»–ä»¬ä¼šç§»åŠ¨åˆ°æ´‹æµæ‰€æŒ‡å‘çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚è¿™ç‰‡æµ·æ´‹ä¸­çš„æ´‹æµæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒä¸ä¼šè®©é¸­å­ä»¬ç§»åŠ¨åˆ°æµ·å›¾ä¹‹å¤–çš„åœ°æ–¹ï¼ŒåŒæ—¶ï¼Œæ´‹æµä¹Ÿæ²¡æœ‰å½¢æˆç¯è·¯ã€‚

â€‹å¹³é™çš„æµ·æ´‹åœ¨æµ·å›¾ä¸­è¢«æ ‡è®°ä¸º `.`ã€‚å¦‚æœæ´‹æµå¸¦é¸­å­ä»¬åˆ°è¾¾äº†å¹³é™æµ·åŸŸï¼Œæˆ–è€…æ—¶å¼€å§‹çš„å²›å±¿ï¼Œé‚£ä¹ˆä»–ä»¬å°±æ— æ³•ç»§ç»­ä»–ä»¬çš„æ—…é€”äº†ã€‚ä»–ä»¬æƒ³è¦åˆ°è¾¾çš„å²›åœ¨å›¾ä¸Šè¢«æ ‡è®°ä¸º `x`ã€‚

â€‹ä½ çš„ä»»åŠ¡æ˜¯å¸®é¸­å­ä»¬åˆ¤æ–­å®ƒä»¬èƒ½å¦åˆ°è¾¾ç›®çš„åœ°ã€‚å¦‚æœå¯ä»¥çš„è¯ï¼Œä»–ä»¬éœ€è¦é€‰æ‹©å“ªä¸€ä¸ªæ–¹å‘ã€‚

â€‹é‰´äºé¸­å­ä»¬å¹¶ä¸å–œæ¬¢æµ·ä¸Šæ¼‚æ³Šçš„æ„Ÿè§‰ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªå¯ä»¥åˆ°è¾¾ç›®çš„åœ°çš„æ–¹å‘ï¼Œä½ éœ€è¦æ‰¾åˆ°è¡ŒåŠ¨è·ç¦»æœ€çŸ­çš„æ–¹å‘ã€‚å¦‚æœå­˜åœ¨è¡ŒåŠ¨è·ç¦»ç›¸åŒçš„æ–¹å‘ï¼Œè¯·æŒ‰ç…§æ–¹å‘çš„å­—å…¸åºè¾“å‡ºå­—å…¸åºæœ€å°çš„æ–¹å‘ã€‚

### è¾“å…¥æè¿°:

â€‹ç¬¬ä¸€è¡ŒåŒ…æ‹¬ä¸¤ä¸ªæ•´æ•° $r$ å’Œ $s(3\leq r,s\leq 100)$ï¼Œè¡¨ç¤ºæµ·å›¾çš„è¡Œæ•°å’Œåˆ—æ•°ã€‚

â€‹æ¥ä¸‹æ¥çš„ $r$ è¡Œï¼Œæ¯ä¸€è¡ŒåŒ…å« $s$ ä¸ªå­—ç¬¦ï¼Œå­—ç¬¦é›†ä¸º `o<>v^.x`ï¼Œä»£è¡¨æµ·æ´‹çš„æƒ…å†µã€‚å›¾ä¸­ä¿è¯åªå­˜åœ¨å”¯ä¸€çš„ `o` å’Œ `x`ã€‚ä¿è¯å­—ç¬¦ `o` ä¸ä¼šå‡ºç°åœ¨ç¬¬ä¸€è¡Œï¼Œç¬¬ä¸€åˆ—ï¼Œæœ€åä¸€è¡Œï¼Œæœ€åä¸€åˆ—ã€‚

### è¾“å‡ºæè¿°:

â€‹å¦‚æœé¸­å­ä»¬æ— æ³•åˆ°è¾¾ç›®çš„å°å²›ï¼Œè¾“å‡º `:(`ã€‚

â€‹å¦åˆ™ï¼Œè¯·åœ¨ç¬¬ä¸€è¡Œè¾“å‡º `:)`ã€‚åœ¨ç¬¬äºŒè¡Œï¼Œè¾“å‡ºå®ƒä»¬å‡ºå‘çš„æ–¹å‘(Nè¡¨ç¤ºå‘åŒ—ï¼ŒEè¡¨ç¤ºå‘ä¸œï¼ŒWè¡¨ç¤ºå‘è¥¿ï¼ŒSè¡¨ç¤ºå‘å—)ã€‚

### åˆ†æ:

â€‹åŠ å¼ºç‰ˆ:[Patkice II](../COCI2020-2021#4/main.md)ã€‚

â€‹æ°´é¢˜ä¸€é“ï¼Œåªä¸è¿‡ç»†èŠ‚æœ‰ä¸€ç‚¹å°å¤šã€‚é¦–å…ˆï¼Œç°å°†å°é¸­å­ä»¬ç§»åŠ¨åˆ°ä¸Šä¸‹å·¦å³å››ä¸ªæ ¼å­ï¼Œç„¶åå†æš´åŠ›æ¨¡æ‹Ÿä¸‹é¸­å­æœ€ç»ˆä¼šç§»åŠ¨åˆ°å“ªä¸ªç‚¹ï¼Œå¹¶åˆ¤æ–­å…¶æ˜¯å¦ä¸ºç»ˆç‚¹ã€‚æ³¨æ„ï¼šä¸‰åªå°é¸­å¯èƒ½ä¼šèµ°å›èµ·ç‚¹ï¼Œå¦‚æœå¿½ç•¥äº†èµ·ç‚¹å¯èƒ½ä¼šæ­»å¾ªç¯ç„¶åè¶…æ—¶ã€‚

â€‹æ—¶é—´å¤æ‚åº¦ä¸º $O(n^2)$ã€‚

### ä»£ç :

```c++
#include<bits/stdc++.h>
#define van long long
#define N 1010
#define ywhin cin
#define ywhout cout
using namespace std;
van n,m;
char cha[N][N];
van len;char ans;
van DFS(van x,van y)
{
	switch(cha[x][y])
	{
		case '.':return -1e18;break;
		case 'o':return -1e18;break;//æ³¨æ„åˆ¤æ–­æ˜¯å¦ä¼šå›åˆ°èµ·ç‚¹
		case 'x':return 0;break;
		case '>':return DFS(x,y+1)+1;break;
		case '<':return DFS(x,y-1)+1;break;
		case 'v':return DFS(x+1,y)+1;break;
		case '^':return DFS(x-1,y)+1;break;
	}
}
int main()
{
//	ifstream ywhin("patkice.in");
//	ofstream ywhout("patkice.out");
	ywhin>>n>>m;ans='z',len=1e18;
	for (int i=1;i<=n;i++) for (int j=1;j<=m;j++) ywhin>>cha[i][j];
	van sx,sy;
	for (int i=1;i<=n;i++) for (int j=1;j<=m;j++) if (cha[i][j]=='o') sx=i,sy=j;
	van res=DFS(sx,sy+1);
	if (res>=0&&res<=len) ans=(len==res)?min(ans,'E'):'E',len=res;
	res=DFS(sx-1,sy);
	if (res>=0&&res<=len) ans=(len==res)?min(ans,'N'):'N',len=res;
	res=DFS(sx+1,sy);
	if (res>=0&&res<=len) ans=(len==res)?min(ans,'S'):'S',len=res;
	res=DFS(sx,sy-1);//æ³¨æ„ç§»åŠ¨æ–¹å‘ä¸è¦å†™é”™äº†
	if (res>=0&&res<=len) ans=(len==res)?min(ans,'W'):'W',len=res;
	if (ans!='z') 
	{
		ywhout<<":)"<<endl;
		ywhout<<ans;
		return 0;
	}
	ywhout<<":(";
	return 0;
}
```



## T2 Bajka

### é¢˜ç›®æè¿°:

â€‹å° $ğ¹ğ‘ğ‘ğ‘–ğ‘—ğ‘–ğ‘ğ‘›$ å·²ç»å¯¹å›¾ç”»ä¹¦æ„Ÿåˆ°åŒå€¦äº†ï¼Œäºæ˜¯ä»–å†³å®šå¼€å§‹é˜…è¯»ä»–çš„ç¬¬ä¸€æœ¬ç«¥è¯ä¹¦ã€‚ä¸å¹¸çš„æ˜¯ï¼Œ$ğ¹ğ‘ğ‘ğ‘–ğ‘—ğ‘–ğ‘ğ‘›$ ç»å¸¸ä¼šé‡è§ä¸€äº›è®©ä»–æ„Ÿåˆ°å®³æ€•çš„è¯è¯­ã€‚ä¸ºäº†æˆ˜èƒœææƒ§ï¼Œä»–ä¼šç©ä¸€ä¸ªä»–è‡ªå·±å‘æ˜çš„æ¸¸æˆã€‚

â€‹ä»¤æˆ‘ä»¬çš„å°ä¸»äººå…¬æ„Ÿåˆ°ææƒ§çš„è¯è¯­æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º $ğ‘›$ çš„å°å†™å­—æ¯åºåˆ—ã€‚å¼€å§‹è¿™ä¸ªæ¸¸æˆæ—¶ï¼Œ$ğ¹ğ‘ğ‘ğ‘–ğ‘—ğ‘–ğ‘ğ‘›$ ä¼šæŠŠä»–çš„æ‰‹æŒ‡æ”¾åœ¨è¿™ä¸ªå­—ç¬¦åºåˆ—çš„ä¸€ä¸ªä½ç½®ä¸Šï¼ŒéšåæŠŠè¿™ä¸ªä½ç½®ä¸Šçš„å­—ç¬¦å†™åˆ°ä¸€å¼ çº¸ä¸Šã€‚æ¥ä¸‹æ¥ï¼Œä»–ä¼šæ‰§è¡Œä¸‹é¢çš„ä¸¤ä¸ªæ“ä½œä¸­çš„æŸä¸€ä¸ªï¼Œä»–ä¼šè¿›è¡Œä»»æ„æ¬¡è¿™æ ·çš„æ“ä½œæ‰§è¡Œã€‚

â€‹1.å°†æ‰‹æŒ‡ç§»åŠ¨åˆ°ç°åœ¨æŒ‡å‘çš„å­—ç¬¦çš„å·¦è¾¹ä¸€ä¸ªå­—ç¬¦æˆ–è€…å³è¾¹ä¸€ä¸ªå­—ç¬¦(å¦‚æœå­˜åœ¨çš„è¯)ã€‚åŒæ—¶ï¼Œ$ğ¹ğ‘ğ‘ğ‘–ğ‘—ğ‘–ğ‘ğ‘›$ ä¹Ÿä¼šæŠŠè¿™ä¸ªæ–°çš„å­—ç¬¦å†™åœ¨åŸæ¥çš„æœ€åä¸€ä¸ªå­—ç¬¦åé¢ã€‚

â€‹2.å°†æ‰‹æŒ‡ç§»åŠ¨åˆ°ä»»æ„ä¸€ä¸ªä¸ç°åœ¨æŒ‡å‘å­—ç¬¦ç›¸åŒçš„å­—ç¬¦å¤„ã€‚è¿™ä¸€è¡ŒåŠ¨ä¸ä¼šå¯¼è‡´ä»»ä½•å­—æ¯ä¹¦å†™ã€‚

â€‹ç§»åŠ¨æ‰‹æŒ‡ä»ä½ç½® $ğ‘¥$ åˆ°ä½ç½® $ğ‘¦$ éœ€è¦èŠ±è´¹çš„æ—¶é—´ä¸º $|ğ‘¥âˆ’ğ‘¦|$ã€‚

â€‹å¦‚æœåœ¨æ¸¸æˆçš„æœ€åï¼Œ$ğ¹ğ‘ğ‘ğ‘–ğ‘—ğ‘–ğ‘ğ‘›$ æœ€å–œæ¬¢çš„è¯è¯­ä¼šå‡ºç°åœ¨çº¸ä¸Šï¼Œé‚£ä¹ˆä»–å°±ä¼šå…‹æœä»–çš„ææƒ§ã€‚ä»–æƒ³è¦å°½å¿«çœ‹å®Œè¿™æœ¬ç«¥è¯ä¹¦ï¼Œå› æ­¤ä»–å¸Œæœ›ä½ å¯ä»¥å‘Šè¯‰ä»–ï¼Œæœ€çŸ­éœ€è¦å¤šå°‘æ—¶é—´ï¼Œä»–æ‰èƒ½å¤Ÿå…‹æœææƒ§ã€‚

### è¾“å…¥æè¿°:

â€‹è¾“å…¥çš„ç¬¬ä¸€è¡ŒåŒ…æ‹¬æ­£æ•´æ•° $ğ‘›$ å’Œ $ğ‘š(1\leq ğ‘›,ğ‘š\leq 3000)$ï¼ˆåŸé¢˜ $1\leq n,m\leq 300$ï¼Œåœ¨æ­¤å¤„åªèƒ½è·å¾—70Ptsï¼‰ã€‚

â€‹è¾“å…¥çš„ç¬¬äºŒè¡ŒåŒ…æ‹¬ $ğ‘›$ ä¸ªå°å†™å­—æ¯ï¼Œè¡¨ç¤º $ğ¹ğ‘ğ‘ğ‘–ğ‘—ğ‘–ğ‘ğ‘›$ å®³æ€•çš„å•è¯ã€‚

â€‹è¾“å…¥çš„ç¬¬ä¸‰è¡ŒåŒ…æ‹¬ $ğ‘š$ ä¸ªå°å†™å­—æ¯ï¼Œè¡¨ç¤º $ğ¹ğ‘ğ‘ğ‘–ğ‘—ğ‘–ğ‘ğ‘›$ æœ€å–œæ¬¢çš„å•è¯ã€‚

### è¾“å‡ºæè¿°:

â€‹è¾“å‡º $ğ¹ğ‘ğ‘ğ‘–ğ‘—ğ‘–ğ‘ğ‘›$ ç”Ÿæˆæœ€å–œæ¬¢çš„å•è¯éœ€è¦çš„æœ€çŸ­æ—¶é—´ï¼Œå¦‚æœæ— æ³•ç”Ÿæˆè¿™ä¸ªå•è¯ï¼Œé‚£ä¹ˆè¾“å‡º `âˆ’1`ã€‚

### åˆ†æ:

#### 30Pts:

â€‹ç¡¬æš´åŠ›ã€‚ç›´æ¥æŒ¨ä¸ªå»æœç´¢å°±è¡Œäº†ã€‚

â€‹æ—¶é—´å¤æ‚åº¦ä¸º $O(m)$ã€‚

#### 70Pts:

â€‹è®¾ $dp[i][j]$ ä¸ºå·²ç»æ‰¾åˆ° $i$ ä¸ªå­—ç¬¦ä¸”å½“å‰æ‰€åœ¨çš„ä½ç½®ä¸º $j$ æ‰€éœ€è¦çš„æœ€å°æ­¥æ•°ã€‚

â€‹é¢„å¤„ç†æŸä¸€ä¸ªå­—æ¯ç©¶ç«Ÿåœ¨å“ªäº›åœ°æ–¹å‡ºç°è¿‡ï¼Œç„¶åå† DP çš„è¿‡ç¨‹ä¸­å¯ä»¥å¿«é€ŸæŸ¥æ‰¾å‡ºä¸‹ä¸€æ­¥ç©¶ç«Ÿå¯ä»¥åˆ°è¾¾å“ªä¸€äº›ä½ç½®ï¼Œå¹¶ä¸”åŠ ä¸ŠäºŒè€…çš„ä½ç½®ä¹‹å·®å°±å¯ä»¥è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªä½ç½®äº†ã€‚

â€‹ç”±äºå­—ç¬¦ä¸²æœ‰å¯èƒ½å…¨éƒ¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´å•ä¸ªçŠ¶æ€è½¬ç§»çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ï¼Œå› æ­¤ï¼Œ

â€‹æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(n^3)$ï¼Œè¿‡ COCI æ•°æ®æ˜¯æ²¡æœ‰é—®é¢˜äº†ã€‚

#### 100Pts:

â€‹è€ƒè™‘å¦‚ä½•é™ä½æ—¶é—´å¤æ‚åº¦ã€‚

â€‹æˆ‘ä»¬å¯ä»¥æ¯æ¬¡è®°å½•åˆ°æŸä¸€ä¸ªçŠ¶æ€æ—¶æ¯ä¸ªç¬¦åˆæ¡ä»¶çš„ç‚¹çš„æœ€å°æ­¥æ•°ï¼Œç„¶åä»å·¦æ‰«ä¸€éï¼Œè®°å½•åˆ°æŸä¸€ä¸ªç‚¹æ—¶çš„æœ€å°æ­¥æ•° $step$ï¼Œå¹¶å°†ç¬¦åˆæ¡ä»¶çš„ä¸‹ä¸€ä¸ªç‚¹çš„æ­¥æ•°èµ‹å€¼ä¸º $step$ï¼Œå†ä»å³å‘å·¦æ‰«ä¸€éï¼Œä¸ä»å·¦å¾€å³æ‰«ä¸€éè·å¾—çš„ç­”æ¡ˆæ¯”è¾ƒï¼Œä¿ç•™å°çš„ï¼Œå†å»å¯»æ‰¾ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚

â€‹æ—¶é—´å¤æ‚åº¦ä¸º $O(n^2)$

### ä»£ç :

```C++
#include<bits/stdc++.h>
#define van long long
#define N 3010
#define ywhin cin
#define ywhout cout
using namespace std;
van f[N];
vector<van> where['z'+1];
char hate[N],like[N];
int main()
{
	memset(f,(1<<8)-1,sizeof f);
	van n,m;
	ywhin>>n>>m;
	for (int i=1;i<=n;i++) ywhin>>hate[i];
	for (int i=1;i<=m;i++) ywhin>>like[i];
	queue<pair<van,van> > q;
	for (int i=1;i<=n;i++) if (hate[i]==like[1]) q.push(make_pair(i,0));
	for (int i=2;i<=m;i++)
	{
		memset(f,(1<<6)-1,sizeof f);
		while (!q.empty())
		{
			pair<van,van> p=q.front();q.pop();
			van place=p.first,step=p.second;
			if (hate[place-1]==like[i]&&place>1) f[place-1]=min(f[place-1],step+1);
			if (hate[place+1]==like[i]&&place<n) f[place+1]=min(f[place+1],step+1);
		}//å°†ä¸Šä¸€è½®çš„ç»“æœå¤åˆ¶åˆ°fæ•°ç»„é‡Œ
		van minans=1e18,pos=0;
		for (int j=1;j<=n;j++) if (hate[j]==like[i])
		{
			van dis=minans+j-pos;
			if (dis>f[j]) minans=f[j],pos=j;
			else if (dis<f[j]) f[j]=dis;
		}//ä»å·¦å¾€å³æ‰«ä¸€é
		minans=1e18,pos=n+1;
		for (int j=n;j>=1;j--) if (hate[j]==like[i])
		{
			van dis=minans+pos-j;
			if (dis>f[j]) minans=f[j],pos=j;
			else if (dis<f[j]) f[j]=dis;
			if (f[j]<1e18) q.push(make_pair(j,f[j]));
		}//ä»å³å¾€å·¦æ‰«ä¸€é
		if (q.empty())
		{
			ywhout<<-1<<endl;
			return 0;
		}//å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„ç‚¹å°±å¯ä»¥è¾“å‡º-1äº†
	}
	van ans=1e18;
	while (!q.empty())
	{
		pair<van,van> p=q.front();q.pop();
		ans=min(ans,p.second);
	}
	ywhout<<ans;
	return 0;
}
```



## T3 Histogram

### é¢˜ç›®æè¿°:

â€‹æœ‰ä¸€ä¸ªé•¿åº¦ä¸º $N$ çš„3Dç›´æ–¹å›¾ã€‚ç¬¬ $i$ ä¸ªæ£±æŸ±çš„å®½åº¦ä¸º 1 ç±³ï¼Œé«˜åº¦ä¸º $a_i$ï¼Œé•¿åº¦ä¸º $b_i$ã€‚æ¢å¥è¯è¯´ï¼Œå…¶ä¸»è§†å›¾(ä»æ­£é¢çœ‹)æ˜¯ä¸€ä¸ªé•¿æ–¹å½¢åºåˆ—ï¼Œç¬¬ $i$ ä¸ªé•¿æ–¹å½¢é«˜ä¸º $a_i$ï¼Œå®½ä¸º 1ã€‚å…¶ä¿¯è§†å›¾(ä»ä¸Šæ–¹çœ‹)æ˜¯ä¸€ä¸ªé•¿æ–¹å½¢åºåˆ—ï¼Œç¬¬ $i$ ä¸ªé•¿æ–¹å½¢é«˜ä¸º $b_i$ï¼Œå®½ä¸º 1ã€‚

â€‹ä½ çš„ä»»åŠ¡æ˜¯æ‰¾å‡ºè¿™ä¸ªç›´æ–¹å›¾å†…å¯ä»¥æ”¾ä¸‹çš„å®¹ç§¯æœ€å¤§çš„æ£±æŸ±ã€‚è¦æ±‚æ£±æŸ±çš„æ£±ä¸ç›´æ–¹å›¾çš„æ£±å¹³è¡Œã€‚

### è¾“å…¥æè¿°:

â€‹è¾“å…¥çš„ç¬¬ä¸€è¡ŒåŒ…æ‹¬ä¸€ä¸ªæ­£æ•´æ•° $N(1\leq N\leq 2\times10^5)$ã€‚è¡¨ç¤ºè¿™ä¸ªç›´æ–¹å›¾çš„é•¿åº¦ã€‚ 

â€‹æ¥ä¸‹æ¥çš„ $n$ è¡Œï¼Œç¬¬ $i$ è¡ŒåŒ…æ‹¬ä¸¤ä¸ªæ­£æ•´æ•° $a_i$ å’Œ $b_i(1\leq a_i,b_i\leq 10^6)$ï¼Œå«ä¹‰è§é¢˜é¢æè¿°ã€‚

### è¾“å‡ºæè¿°:

â€‹è¾“å…¥æœ€å¤§å†…æ¥æ£±æŸ±çš„å®¹ç§¯ã€‚

### åˆ†æ:

#### 20Pts:

â€‹çˆ†è‚ä¸€éå°±å®Œäº‹äº†ã€‚æšä¸¾åŒºé—´çš„ $l$ èŠ‚ç‚¹ä¸åŒºé—´é•¿åº¦ï¼Œç„¶åè®¡ç®—ç­”æ¡ˆå¹¶ä¸”ä¸  $ans$ æ¯”è¾ƒå³å¯ã€‚

â€‹æ—¶é—´å¤æ‚åº¦ä¸º $O(n^2)$ ã€‚

#### 100Pts:

â€‹è€ƒè™‘ä½¿ç”¨åˆ†æ²»è§£å†³æ­¤é¢˜ã€‚

â€‹å°†åŒºé—´ $[l,r]$ åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚ä¸éš¾å‘ç°ï¼Œ$a$ çš„æœ€å°å€¼ä¸ $b$ çš„æœ€å°å€¼çš„åˆ†å¸ƒåªä¼šæœ‰ä¸¤ç§æƒ…å†µã€‚å³ $a$ çš„æœ€å°å€¼åœ¨å·¦è¾¹/å³è¾¹ä¸ $b$ çš„æœ€å°å€¼åœ¨å·¦è¾¹/å³è¾¹ã€‚

â€‹åˆ†å¼€è®¨è®ºï¼Œå½“ $a,b$ çš„æœ€å°å€¼åœ¨åŒä¸€è¾¹æ—¶ï¼Œæšä¸¾ $a,b$ çš„æœ€å°å€¼å¹¶åœ¨å¦ä¸€è¾¹æŸ¥æ‰¾èƒ½èµ°åˆ°çš„æœ€è¿œçš„åœ°æ–¹å°±è¡Œäº†ã€‚

â€‹å½“ $a,b$ çš„æœ€å°å€¼ä¸åœ¨åŒä¸€è¾¹æ—¶ï¼Œè®¾ $c_i=\min(a_{mid},a_{mid-1},...,a_{mid-i}),d_i=\min(b_{mid+1},b_{mid+2},...,b_{mid+i})$ï¼Œä»¥åŠ $f_j(i)=-i\times d_j+j\times d_j,i\leq j$ã€‚çº¿æ®µæ ‘ç»´æŠ¤ $[l,r]$ è¿™ä¸ªåŒºé—´é‡Œæ‰€æœ‰å‡½æ•°çš„å‡¸åŒ…ï¼Œæœ€åæŸ¥è¯¢è¿™ä¸ªçº¿æ®µæ ‘çš„å€¼å†ä¹˜ä¸Š $c_i$ çš„å€¼å°±è¡Œäº†ã€‚

â€‹å¦ä¸€ç§åŒç†ã€‚

â€‹æ—¶é—´å¤æ‚åº¦ä¸º $O(n\log_2^2n)$ã€‚

### ä»£ç :

ä»£ç é“¾æ¥:[[DSè®°å½•\]P7164 [COCI2020-2021#1] 3D Histogram - command_block çš„åšå®¢ - æ´›è°·åšå®¢ (luogu.com.cn)](https://www.luogu.com.cn/blog/command-block/ds-ji-lu-p7164-coci2020-20211-3d-histogram)

```C++
#include<algorithm>
#include<cstdio>
#include<vector>
#define pb push_back
#define ll long long
#define MaxN 200500
using namespace std;
const int INF=1000000000;
struct Line{
  ll k,b;
  ll get(int x)
  {return k*x+b;}
  bool operator < (const Line &B) const
  {return k<B.k;}
};
bool chk(const Line &A,const Line &B,const Line &C){
  ll x1=A.k-B.k,y1=A.b-B.b
    ,x2=C.k-B.k,y2=C.b-B.b;
  return x1*y2-y1*x2>0; 
}
#define Hull vector<Line>
Line st[MaxN];
void max(const Hull &A,const Hull &B,Hull &C)
{
  merge(A.begin(),A.end(),B.begin(),B.end(),st);
  int n=A.size()+B.size();
  C.clear();
  for (int i=0;i<n;i++){
    while(C.size()>=2&&!chk(C[C.size()-2],C.back(),st[i]))C.pop_back();
    C.pb(st[i]);
  }
}
struct Node{Hull s;int p;};
ll get(Hull &s,int &p,int x){
  while(p+1<s.size()&&s[p+1].get(x)>s[p].get(x))p++;
  return s[p].get(x);
}
struct HullDS
{
  Node a[1<<18|500];
  Line sl[MaxN];
  int tl,tr;
  void build(int l,int r,int u)
  {
    a[u].s.clear();a[u].p=0;
    if (l==r){a[u].s.pb(sl[l]);return ;}
    int mid=(l+r)>>1;
    build(l,mid,u<<1);
    build(mid+1,r,u<<1|1);
    max(a[u<<1].s,a[u<<1|1].s,a[u].s);
  }
  int wfl,wfr,wfx;ll ret;
  void _qry(int l,int r,int u)
  {
    if (wfl<=l&&r<=wfr){
      ret=max(ret,get(a[u].s,a[u].p,wfx));
      return ;
    }int mid=(l+r)>>1;
    if (wfl<=mid)_qry(l,mid,u<<1);
    if (mid<wfr)_qry(mid+1,r,u<<1|1);
  }
  ll qry(int l,int r,int x){
    wfl=l;wfr=r;wfx=x;
    ret=0;_qry(tl,tr,1);
    return ret;
  }
}T0,T1,T01;
struct Data{int x0,x1;}s[MaxN];
int h0[MaxN],h1[MaxN];ll ans;
void solve(int l,int r)
{
  if (l==r)return ;
  int mid=(l+r)>>1;
  solve(l,mid);solve(mid+1,r);
  h1[mid]=h0[mid]=INF;
  T0.tl=T1.tl=T01.tl=mid+1;
  T0.tr=T1.tr=T01.tr=r;
  // (c0+c1)*min(t0,h0)*min(t1,h1)
  for (int i=mid+1;i<=r;i++){
    h0[i]=min(s[i].x0,h0[i-1]);
    h1[i]=min(s[i].x1,h1[i-1]);
    T0.sl[i]=(Line){h0[i],1ll*h0[i]*(i-mid)};
    //(c0+c1)*h0*t1 = t1*(c0*h0+c1*h0)
    T1.sl[i]=(Line){h1[i],1ll*h1[i]*(i-mid)};
    //(c0+c1)*t0*h1 = t0*(c0*h1+c1*h1)
    T01.sl[i]=(Line){1ll*h0[i]*h1[i],1ll*h0[i]*h1[i]*(i-mid)};
    //(c0+c1)*h0*h1 = c0*h0*h1+c1*h0*h1
  }
  T0.build(mid+1,r,1);
  T1.build(mid+1,r,1);
  T01.build(mid+1,r,1);
  for (int i=mid,t0=INF,t1=INF,p0=mid,p1=mid;i>=l;i--){
    t0=min(t0,s[i].x0);
    t1=min(t1,s[i].x1);
    while(p0<r&&h0[p0+1]>=t0)p0++;
    while(p1<r&&h1[p1+1]>=t1)p1++;
    ans=max(ans,1ll*(min(p0,p1)-i+1)*t0*t1);
    if (p0<p1)ans=max(ans,t1*T0.qry(p0+1,p1,mid-i+1));
    if (p1<p0)ans=max(ans,t0*T1.qry(p1+1,p0,mid-i+1));
    if (max(p0,p1)<r)ans=max(ans,T01.qry(max(p0,p1)+1,r,mid-i+1));
  }
}
int n;
int main()
{
  scanf("%d",&n);
  for (int i=1;i<=n;i++){
    scanf("%d%d",&s[i].x0,&s[i].x1);
    ans=max(ans,1ll*s[i].x0*s[i].x1);
  }solve(1,n);
  printf("%lld",ans);
  return 0;
}
```



## T4 Papricice

### é¢˜ç›®æè¿°:

â€‹åœ¨èŠ±å›­å¿™ç¢Œäº†ä¸€ä¸ªæ—©ä¸Šä¹‹åã€‚M å…ˆç”Ÿå†³å®šç”¨è‡ªå·±ç§çš„å¹²è¾£æ¤’å¥–åŠ±ä¸€ä¸‹è‡ªå·±ã€‚ 

â€‹M å…ˆç”Ÿæœ‰ $n$ é¢—è¾£æ¤’ï¼Œè¿™äº›è¾£æ¤’ç”± $n-1$ æ¡çº¿é“¾æ¥è€Œæˆã€‚ä»»æ„ä¸¤é¢—è¾£æ¤’éƒ½å¯ä»¥é€šè¿‡è‹¥å¹²æ¡çº¿è¿æ¥èµ·æ¥ã€‚ç®€å•æ¥è¯´ï¼Œè¿™ $n$ é¢—è¾£æ¤’å’Œè¿™ $n-1$ æ¡çº¿è¿æ¥æˆäº†ä¸€æ£µæ ‘ã€‚ 

â€‹M å…ˆç”Ÿä»Šå¤©è¦åƒä¸‰é¡¿é¥­ï¼Œå› æ­¤ä»–éœ€è¦å‰ªæ–­ä¸¤æ¡çº¿ã€‚è·å¾—ä¸‰ä¸²å°çš„è¾£æ¤’ã€‚æ¯ä¸€é¡¿é¥­éœ€è¦ä½¿ç”¨ä¸€ä¸²è¾£æ¤’ã€‚

â€‹æ˜¾ç„¶ï¼Œä¸€é¡¿é¥­ä¸èƒ½å¤ªè¾£ï¼Œå› æ­¤ä»–ä¼šé€‰æ‹©ä¸€ç§åˆ†å‰²æ–¹æ³•ï¼Œä½¿å¾—**è¾£æ¤’æœ€å¤šçš„è¾£æ¤’ä¸²å’Œè¾£æ¤’æœ€å°‘çš„è¾£æ¤’ä¸²çš„æ•°é‡å·®è·æœ€å°ã€‚**ä½ çš„ä»»åŠ¡å°±æ˜¯æ±‚å‡ºè¿™ä¸ªæœ€å°çš„å·®è·ã€‚

### è¾“å…¥æè¿°:

â€‹è¾“å…¥çš„ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° $n(1\leq n\leq 2\times10^5)$ï¼Œè¡¨ç¤ºè¾£æ¤’çš„æ•°é‡ã€‚è¾£æ¤’ä»1åˆ° $n$ ç¼–å·ã€‚ 

â€‹æ¥ä¸‹æ¥çš„ $n-1$ è¡Œï¼Œæ¯è¡ŒåŒ…æ‹¬ä¸¤ä¸ªæ•´æ•° $x$ å’Œ $y(1\leq x,y\leq n)$ã€‚è¡¨ç¤ºç”±ä¸€æ¡è¿æ¥ç¼–å·ä¸º $x$ çš„è¾£æ¤’å’Œç¼–å·ä¸º $y$ çš„è¾£æ¤’çš„çº¿ã€‚

### è¾“å‡ºæè¿°:

â€‹è¾“å‡ºä¸€è¡Œï¼Œä¸€ä¸ªæ•´æ•°ï¼Œå³æœ€å°çš„æœ€å¤§è¾£æ¤’ä¸²å’Œæœ€å°è¾£æ¤’ä¸²çš„æ•°é‡å·®è·ã€‚

### åˆ†æ:

#### 50Pts:

â€‹æš´åŠ›æšä¸¾è¦åˆ é™¤çš„é‚£ä¸¤ä¸ªç‚¹ï¼Œç„¶åè®¡ç®—è¿™ä¸‰ä¸ªéƒ¨åˆ†çš„ç‚¹çš„æ•°é‡å¹¶æ›´æ–° $ans$ çš„å€¼å°±è¡Œäº†ã€‚

â€‹æ—¶é—´å¤æ‚åº¦ä¸º $O(n^2)$ã€‚

#### 100Pts:

â€‹å‡è®¾æˆ‘ä»¬å·²ç»åˆ‡æ‰äº†ç‚¹ $x$ ä¸å…¶çˆ¶äº²èŠ‚ç‚¹æ‰€å½¢æˆçš„çš„è¾¹ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦æŸ¥æ‰¾ä¸‹ä¸€ä¸ªéœ€è¦åˆ é™¤çš„è¾¹ç©¶ç«Ÿæ˜¯å“ªä¸€æ¡ã€‚

â€‹åˆ†æˆä¸¤ç§æƒ…å†µè€ƒè™‘ï¼š

â€‹1.å½“å¦ä¸€æ¡è¾¹åœ¨å…¶ç¥–å…ˆèŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦åˆ†å‡ºçš„å¦ä¸€ä¸ªéƒ¨åˆ†çš„èŠ‚ç‚¹æ•°é‡æœ€å¥½ä¸º $\frac{n-size[x]}{2}$ã€‚ç”±äºå…¶ç¥–å…ˆèŠ‚ç‚¹ $y$ çš„ $size_y$ åŒ…å«äº† $x$ çš„å­æ ‘ä¸‹æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ° $x$ çš„ç¥–å…ˆèŠ‚ç‚¹ä¸­å­æ ‘çš„èŠ‚ç‚¹æ•°æœ€é è¿‘ $\frac{n+size[x]}{2}$ çš„ä¸€ä¸ªç‚¹å¹¶è®¡ç®—å½“å‰æƒ…å†µä¸‹çš„æœ€ç»ˆç»“æœå¹¶å°†å…¶ä¸ $ans$ æ¯”è¾ƒå³å¯ã€‚

â€‹2.å½“å¦ä¸€æ¡è¾¹åœ¨å·²ç»è¢«è®¿é—®è¿‡çš„å­æ ‘ä¸Šæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°å·²ç»è®¿é—®è¿‡çš„èŠ‚ç‚¹ä¸­å­æ ‘çš„èŠ‚ç‚¹æ•°æœ€æ¥è¿‘ $\frac{n-size[x]}{2}$ çš„ä¸€ä¸ªç‚¹å¹¶è®¡ç®—å½“å‰æƒ…å†µä¸‹çš„æœ€ç»ˆç»“æœå¹¶å°†å…¶ä¸ $ans$ æ¯”è¾ƒã€‚

â€‹è‡³äºå¦‚ä½•æŸ¥æ‰¾ï¼Œä½¿ç”¨ multiset è‡ªå¸¦çš„ lower_bound å‡½æ•°å³å¯ã€‚

â€‹æ—¶é—´å¤æ‚åº¦ä¸º $O(n\log_2n )$ã€‚

### ä»£ç :

```c++
#include<bits/stdc++.h>
#define van long long
#define N 200010
#define ywhin cin
#define ywhout cout
using namespace std;
van n;vector<van> g[N];
bool used[N];van siz[N],ans=1e18;
multiset<van> father,son;
void init(van now)
{
//	cout<<now<<endl;
	used[now]=1,siz[now]=1;van v;
	for (int i=0;i<g[now].size();i++) if (!used[v=g[now][i]]) init(v),siz[now]+=siz[v];
}//è®¡ç®—å­æ ‘ä¸­çš„èŠ‚ç‚¹æ•°
void DFS(van now)
{
	used[now]=1;van v;
	multiset<van>::iterator it;van siz2,last,tmpans;
	if (!father.empty())
	{
		it=father.lower_bound((n-siz[now])/2+siz[now]);
		if (it!=father.end())
		{
			siz2=*it-siz[now];
			last=n-siz2-siz[now];
			tmpans=max(siz[now],max(siz2,last))-min(siz[now],min(siz2,last));
			ans=min(ans,tmpans);	
		}
		if (it!=father.begin())
		{
			it--;
			siz2=*it-siz[now];
			last=n-siz2-siz[now];
			tmpans=max(siz[now],max(siz2,last))-min(siz[now],min(siz2,last));
			ans=min(ans,tmpans);	
		}
	}//ç¬¬ä¸€ç§æƒ…å†µ
	if (!son.empty())
	{
		it=son.lower_bound((n-siz[now])/2);
		if (it!=son.end())
		{
			siz2=*it;
			last=n-siz2-siz[now];
			tmpans=max(siz[now],max(siz2,last))-min(siz[now],min(siz2,last));
			ans=min(ans,tmpans);	
		}
		if (it!=son.begin())
		{
			it--;
			siz2=*it;
			last=n-siz2-siz[now];
			tmpans=max(siz[now],max(siz2,last))-min(siz[now],min(siz2,last));
			ans=min(ans,tmpans);	
		}
	}//ç¬¬äºŒç§æƒ…å†µ
	if (now!=1) father.insert(siz[now]);//å°†è‡ªå·±åŠ åˆ°ç¥–å…ˆé›†åˆä¸­
	for (int i=0;i<g[now].size();i++) if (!used[v=g[now][i]]) DFS(v);
	if (now!=1) father.erase(father.find(siz[now]));//å°†è‡ªå·±ç§»é™¤ç¥–å…ˆé›†åˆ
	if (now!=1) son.insert(siz[now]);//å°†è‡ªå·±ç§»å…¥å·²è®¿é—®çš„èŠ‚ç‚¹çš„é›†åˆ
}
int main()
{
	ywhin>>n;
	for (int i=1;i<n;i++)
	{
		van f,s;
		scanf("%lld %lld",&f,&s);
		g[f].push_back(s);
		g[s].push_back(f);
	}//å»ºå›¾
	init(1);
	memset(used,0,sizeof used);
	DFS(1);
	ywhout<<ans<<endl;
	return 0;
}
```



## T5 Tenis

### é¢˜ç›®æè¿°:

â€‹ç±³å°”ç§‘å…ˆç”Ÿæ˜¯ä¸€ä¸ªç½‘çƒçš„ç‹‚çƒ­ç²‰ä¸ã€‚ä¸ä¹…ä¹‹åï¼Œä¸€ä¸ªé‡è¦çš„é”¦æ ‡èµ›å°±è¦å¼€å§‹äº†ï¼Œè¿™åœºé”¦æ ‡èµ›ä¸€å…±æœ‰ $n$ ä½å‚èµ›é€‰æ‰‹ã€‚ç±³å°”ç§‘å…ˆç”ŸèŠ±è´¹äº†å¤šå¹´æ—¶é—´ç ”ç©¶å‚èµ›è€…ä»¬å¹¶æ”¶é›†äº†å¤§é‡çš„æ•°æ®ã€‚å®ƒå°†ä»–ä»¬åœ¨ä¸‰ç§ä¸åŒåœºåœ°ä¸Šçš„å®åŠ›è°ƒæŸ¥æ¸…æ¥šã€‚å¹¶æŒ‰ç…§æ¯ä¸€ä¸ªä¸åŒçš„åœºåœ°ç»™è¿åŠ¨å‘˜ä»¬è¿›è¡Œäº†ä¸€ä¸ªæ’åºï¼Œæ’åºä¸ºä¸€çš„è¡¨ç¤ºåœ¨è¿™ä¸€åœºåœ°ä¸Šï¼Œè¿™ä¸€è¿åŠ¨å‘˜æ˜¯æœ€å¼ºçš„ã€‚æ’åºæœ€åçš„æœ€å¼±ã€‚

â€‹åœ¨è¿™æ¬¡çš„é”¦æ ‡èµ›ä¸­ï¼Œæ¯ä¸¤ä½é€‰æ‰‹éƒ½ä¼šæ­£å¥½äº¤æ‰‹ä¸€æ¬¡ã€‚å› æ­¤ä¸€å…±ä¼šæœ‰ $\frac{n(n-1)}{2}$ åœºæ¯”èµ›ã€‚ä¸€åœºç½‘çƒèµ›æ˜¯ä¸ä¼šæœ‰å¹³å±€çš„ï¼Œ**åœ¨è¿™ä¸ªåœºåœ°ä¸Šå®åŠ›æ’åºæ›´å¼ºçš„é€‰æ‰‹ä¼šè·å¾—èƒœåˆ©ã€‚**ä¸»åŠæ–¹å¯¹æ­¤å¿ƒçŸ¥è‚šæ˜ï¼Œå› æ­¤ä»–ä»¬å†³å®šå°†æ¯åœºæ¯”èµ›å®‰æ’åœ¨èƒœè€…æ°´å¹³æœ€é«˜çš„åœºåœ°ï¼Œä¹Ÿå°±æ˜¯è¯´æ’åæœ€é å‰çš„åœºåœ°ä¸Šã€‚å¦‚æœå­˜åœ¨ä¸¤ä¸ªåœºåœ°èƒœè€…æ’åç›¸åŒ(ä¾‹å¦‚ï¼šè¿åŠ¨å‘˜ A å’Œ B è¿›è¡Œæ¯”èµ›ï¼ŒA åœ¨åœºåœ° 1 ä¸Šä¼šè·èƒœï¼ŒB åœ¨åœºåœ° 2 ä¸Šä¼šè·èƒœï¼Œä½†æ˜¯äºŒè€…åœ¨å¯¹åº”çš„åœºåœ°ä¸Šæ‹¥æœ‰ç›¸åŒçš„æ’å)ï¼Œä»–ä»¬å°±ä¼šé€‰æ‹©è´¥æ–¹æ’åæœ€å¥½çš„åœºåœ°ï¼Œå¦‚æœè´¥æ–¹æ’åç›¸åŒï¼Œé‚£ä¹ˆä»–ä»¬å°±ä¼šé€‰æ‹©ç¼–å·æœ€å°çš„åœºåœ°ã€‚ 

â€‹ä½ çš„ä»»åŠ¡æ˜¯ç®—å‡ºé”¦æ ‡èµ›çš„ç»“æœï¼ŒåŒ…æ‹¬ï¼šä¸åŒåœºåœ°ä¸Šçš„æ¯”èµ›åœºæ•°ï¼Œæ¯ä¸€ä½è¿åŠ¨å‘˜çš„è·èƒœæ¬¡æ•°ã€‚

### è¾“å…¥æè¿°:

â€‹è¾“å…¥çš„ç¬¬ä¸€è¡ŒåŒ…æ‹¬ä¸€ä¸ªæ•´æ•° $n(1\leq n\leq 10^5)$ï¼Œè¡¨ç¤ºè¿åŠ¨å‘˜çš„æ•°é‡ï¼Œè¿åŠ¨å‘˜ä»¬ä» 1 åˆ° $n$ ç¼–å·ã€‚ 

â€‹æ¥ä¸‹æ¥çš„ 3 è¡Œè¾“å…¥ï¼Œæ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„åºåˆ—ï¼Œè¿™ä¸ªåºåˆ—æ˜¯ $1$ ~ $n$ çš„ä¸€ä¸ªæ’åˆ—ï¼Œè¡¨ç¤ºåœ¨è¿™ä¸ªåœºåœ°ä¸Šé€‰æ‰‹çš„å®åŠ›æ’åºï¼Œç¬¬ä¸€ä¸ªè¾“å…¥çš„ç¼–å·å°±æ˜¯è¿™ä¸ªåœºåœ°ä¸Šå®åŠ›æœ€å¼ºçš„é€‰æ‰‹ç¼–å·ï¼Œä»¥æ­¤ç±»æ¨ã€‚

### è¾“å‡ºæè¿°:

â€‹è¾“å‡ºçš„ç¬¬ä¸€è¡Œï¼ŒåŒ…æ‹¬ä¸‰ä¸ªæ•´æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºåœ¨åœºåœ° 1,2,3 ä¸Šä¸¾åŠçš„æ¯”èµ›çš„æ•°é‡ã€‚ 

â€‹è¾“å‡ºçš„ç¬¬äºŒè¡ŒåŒ…æ‹¬ $n$ ä¸ªæ•´æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºç¼–å·ä» 1 åˆ° $n$ çš„æ¯ä¸€ä½é€‰æ‰‹çš„è·èƒœåœºæ¬¡ã€‚

### åˆ†æ:

â€‹æˆ‘ä»¬å°†æ¯”èµ›åˆ†æˆä¸¤ç±»ï¼šç¬¬ä¸€ç§æ˜¯ä¸¥æ ¼çš„èƒœåˆ©ï¼Œå³èµ¢å®¶çš„è·èƒœä½ç½®ä¸¥æ ¼å°äºè¾“å®¶çš„è·èƒœä½ç½®ã€‚ç¬¬äºŒç§æ˜¯éä¸¥æ ¼çš„èƒœåˆ©ï¼Œè¿™æ„å‘³ç€çƒå‘˜åœ¨çƒåœºä¸Šçš„è·èƒœä½ç½®æ˜¯ç›¸ç­‰çš„ã€‚

â€‹ç°åœ¨é—®é¢˜è½¬åŒ–ä¸ºåœ¨ä¸€ä¸ª 3 åˆ—çš„ç½‘æ ¼ä¸Šç»Ÿè®¡ã€‚ä»å·¦å¾€å³æ‰«ä¸€éï¼Œå¯¹äºè¿™ä¸€åˆ—çš„æ¯ä¸ªçƒå‘˜æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç»Ÿè®¡ $(i+1,n)$ çš„ç­”æ¡ˆï¼›å¦åˆ™ç›´æ¥è·³è¿‡ã€‚å…·ä½“æˆ‘ä»¬è¦ç»´æŠ¤ $cnt[8][3]$ è¡¨ç¤ºåœ¨çŠ¶æ€ $mask$ çš„ç¬¬ $i$ è¡Œæ’çš„æœ€å°ä¸”çƒåœºç¼–å·æœ€å°çš„çƒå‘˜çš„ä½ç½®ã€‚

â€‹ç°åœ¨æˆ‘ä»¬è®¡ç®—éä¸¥æ ¼èƒœåˆ©ã€‚æšä¸¾ $i$ , $j$ è¡Œ $(i<j)$, å¦‚æœ $x$, $y$ éƒ½ä¸ç­‰äº 0 $(x\not=y)$, æˆ‘ä»¬å¯ä»¥æšä¸¾ $k\in [0,2]$ , ä½¿å¾—åœ¨è¾“å®¶ä½ç½®æœ€é å‰çš„æƒ…å†µä¸‹åœºåœ°ç¼–å·æœ€å°ï¼Œå°±å¯ä»¥æ¯”è¾ƒå‡º $x$ , $y$ çš„ç»“æœã€‚

â€‹å¸¸æ•°å¤§æ¦‚æœ‰ $2^3\times 3^2=72$ã€‚æ—¶é—´å¤æ‚åº¦ä¸º $O(72\times n)$ã€‚

### ä»£ç :

```C++
#include<bits/stdc++.h>
#define van long long
#define N 100010
#define ywhin cin
#define ywhout cout
using namespace std;
van garbage[3][N],n;
van que[N][3],cnt[8][3];
van ans1[N],ans2[N];
van in[N];
void add(van w,van d)
{
	for(int i=1;i<=7;i++) 
	{
		van min_=-1;
		for (int j=0;j<3;j++) if ((i>>j&1)&&(min_==-1||que[w][j]<que[w][min_])) min_=j;
		cnt[i][min_]+=d;
	}
}//ç»´æŠ¤cnt
int main()
{
	ywhin>>n;
	for (int i=0;i<3;i++) for (int j=1;j<=n;j++) ywhin>>garbage[i][j];
	for (int i=0;i<3;i++) for (int j=1;j<=n;j++) que[garbage[i][j]][i]=j;
	for (int i=1;i<=n;i++) add(i,1);
	for (int i=1;i<=n;i++) 
	{
		for (int j=0;j<3;j++) 
			if (in[garbage[j][i]]) garbage[j][i]=0;
			else
			{
				add(garbage[j][i],-1);
				for (int k=j;k<3;k++) if (garbage[k][i]==garbage[j][i]) in[garbage[j][i]]|=1<<k;
			}
		for (int j=0;j<3;j++) if (garbage[j][i])
		{
			van haha=garbage[j][i];
			for (int k=0;k<3;k++)
			{
				ans1[k]+=cnt[in[haha]][k];
				ans2[haha]+=cnt[in[haha]][k];
			}
			for (int k=j+1;k<3;k++) if (garbage[k][i])
			{
				van ha=garbage[k][i];
				pair<van,van> min_=make_pair(n+1,n+1);
				for (int l=0;l<3;l++) 
				{
					if (que[haha][l]==i) min_=min(min_,make_pair(que[ha][l],(van)l));
					if (que[ha][l]==i) min_=min(min_,make_pair(que[haha][l],(van)l));
				}
				ans1[min_.second]++;
				ans2[que[haha][min_.second]==i?haha:ha]++;
			}
		}
	}
	ywhout<<ans1[0]<<" "<<ans1[1]<<" "<<ans1[2]<<endl;
	for (int i=1;i<=n;i++) ywhout<<ans2[i]<<" ";
	ywhout<<endl;
	return 0;
}
```


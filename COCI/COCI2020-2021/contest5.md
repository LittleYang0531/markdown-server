# COCI2020-2021#5 åšé¢˜è®°å½•

## T1 Sifra

### é¢˜ç›®æè¿°:

â€‹éª‘å£« $Borna$ æ­£åœ¨è¯•å›¾ç ´è¯‘ä¸€å°æ¥è‡ªä»–çš„æ•Œäººçš„ç§˜å¯†ä¿¡ä»¶ã€‚è¿™å°ä¿¡ä»¶ç”±ä¸€ä¸ªç”±å°å†™å­—æ¯å’Œæ•°å­—ç¬¦å·ç»„æˆï¼Œ $Borna$ éœ€è¦ç ´è¯‘å‡ºæ¥çš„å¯†ç å°±æ˜¯å­—ç¬¦ä¸²å†…ä¸åŒçš„æ•°å­—ä¸ªæ•°ã€‚(è¿ç»­çš„æ•°å­—å­—ç¬¦çœ‹æˆä¸€ä¸ªæ•°å­—ï¼Œä¸å¯æ‹†å¼€) 

â€‹è¾“å…¥ä¿è¯å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸€ä¸ªæ•°å­—éƒ½æ²¡æœ‰å‰å¯¼é›¶ã€‚ä½ çš„ä»»åŠ¡å°±æ˜¯æ±‚å‡ºä¸åŒçš„æ•°å­—çš„ä¸ªæ•°ã€‚

### è¾“å…¥æè¿°:

â€‹ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé•¿åº¦åœ¨1åˆ°100ä¹‹é—´ï¼Œå­—ç¬¦ä¸²ç”±å°å†™å­—æ¯å’Œæ•°å­—å­—ç¬¦ç»„æˆã€‚è¾“å…¥ä¿ è¯æ‰€æœ‰çš„æ•°å­—æœ€å¤šåªç”±ä¸‰ä¸ªæ•°å­—å­—ç¬¦ç»„æˆã€‚

### è¾“å‡ºæè¿°:

â€‹è¾“å‡ºå­—ç¬¦ä¸²å†…ä¸åŒçš„æ•°å­—æ•°é‡ã€‚

### åˆ†æ:

â€‹æ°´é¢˜ä¸€é“ï¼Œä»å·¦å¾€å³æ‰«ä¸€éå­—ç¬¦ä¸²ï¼Œå½“æ‰«åˆ°äº†æŸä¸€ä¸ªæ•°å­—çš„æ—¶å€™ï¼Œåœ¨å¾ªç¯å†…éƒ¨ç»§ç»­æ‰«ä¸‹å»ï¼Œç›´åˆ°æ‰«ä¸åˆ°æ•°å­—äº†ä¸ºæ­¢ï¼Œå¹¶å°†å¤–å±‚å¾ªç¯çš„ $i$ èµ‹å€¼ä¸ºå½“å‰çš„ä½ç½®ï¼Œè‡³äºè®¡ç®—è¿™ä¸ªæ•°å­—æ˜¯å¤šå°‘ï¼Œåªéœ€è¦æŒ‰ç…§å¿«è¯»çš„æ€è·¯è®¡ç®—å°±è¡Œäº†ã€‚

â€‹æ—¶é—´å¤æ‚åº¦ä¸º $O(s.size())$ã€‚

### ä»£ç :

```C++
#include<bits/stdc++.h>
#define van long long
#define N 1010
#define ywhin cin
#define ywhout cout
using namespace std;
bool used[N];van an;
int main()
{
//	ifstream ywhin("sifra.in");
//	ofstream ywhout("sifra.out");
	string x;
	ywhin>>x;
	for (int i=0;i<x.size();i++)
	{
		van ans=0;
		while (x[i]>='0'&&x[i]<='9') ans*=10,ans+=x[i]-'0',i++;
		if (ans!=0) used[ans]=1,i--;
	}
	for (int i=0;i<=1000;i++) if (used[i]) an++;
	ywhout<<ans<<endl;
	return 0;
}
```



## T2 Po

### é¢˜ç›®æè¿°:

â€‹ä½ ä¼šè·å¾—ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„åºåˆ— $a_i$ï¼Œè¿™ä¸ªåºåˆ—æ˜¯ç”±ä¸€ä¸ªåˆå§‹åºåˆ—ç»è¿‡è‹¥å¹²å˜æ¢å¾—åˆ°çš„ã€‚åˆå§‹åºåˆ—æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„å…¨0åºåˆ—ã€‚å¯èƒ½å‡ºç°çš„å˜æ¢è§„åˆ™å¦‚ä¸‹ï¼š

â€‹å•ä¸ªå˜æ¢çš„æ•ˆæœä¸ºé€‰æ‹©ä¸€ä¸ªåŒºé—´ [$l$, $r$]ï¼Œå°† $a_l,a_{l+1},...,a_r$ çš„å€¼åŠ ä¸Šä¸€ä¸ªæ­£æ•´æ•° $x$ã€‚ä»»æ„ä¸¤æ¬¡å˜æ¢çš„åŒºé—´åªèƒ½**äº’ä¸ç›¸äº¤æˆ–è€…ä¸€ä¸ªåŒºé—´åŒ…å«å¦ä¸€ä¸ªåŒºé—´**ã€‚ 

â€‹ä½ çš„é—®é¢˜æ˜¯ï¼Œå¯¹äºç»™å®šçš„åºåˆ— $a_i$ï¼Œè¿™ä¸ªåºåˆ—è‡³å°‘æ˜¯è¿›è¡Œäº†å¤šå°‘æ¬¡å˜æ¢å¾—åˆ°çš„ã€‚

### è¾“å…¥æè¿°:

â€‹è¾“å…¥çš„ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•´æ•° $n(1\leq n\leq 10^5)$ï¼Œè¡¨ç¤ºåºåˆ—çš„é•¿åº¦ã€‚

â€‹è¾“å…¥çš„ç¬¬äºŒè¡ŒåŒ…å«ğ‘›ä¸ªéè´Ÿæ•´æ•° $a_i(0\leq a_i\leq 10^9)$ã€‚è¡¨ç¤ºç»è¿‡è‹¥å¹²æ¬¡å˜æ¢å¾—åˆ°çš„åºåˆ—ã€‚

### è¾“å‡ºæè¿°:

â€‹è¾“å‡ºä¸€ä¸ªæ•´æ•°$m$ï¼Œè¡¨ç¤ºè¦å¾—åˆ°è¿™ä¸ªåŒºé—´çš„æœ€å°‘çš„å˜æ¢æ¬¡æ•°ã€‚

### åˆ†æ:

â€‹åˆ†æé¢˜æ„ï¼Œé¦–å…ˆè¿™ä¸ªé¢˜åŠ ä¸Šçš„è¿™ä¸ªæ­£æ•´æ•° $x$ åªèƒ½æ˜¯ä¸ªæ­£æ•´æ•°ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åœ¨æ¯æ¬¡å˜æ¢æ—¶åªèƒ½å˜æ¢åˆ°å½“å‰åŒºé—´æœ€å°çš„ä¸€ä¸ªå€¼ï¼Œå¦‚æœå˜æ¢åˆ°çš„ä¸æ˜¯æœ€å°çš„ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆå°±å†ä¹Ÿå˜æ¢ä¸åˆ°å½“å‰åŒºé—´çš„æœ€å°å€¼äº†ã€‚

â€‹è€ƒè™‘é€šè¿‡åˆ†æ²»æ¥è§£å†³æ­¤é—®é¢˜ã€‚æ¯æ¬¡å˜æ¢æ—¶æŸ¥è¯¢å½“å‰åŒºé—´çš„æœ€å°å€¼ï¼Œå¹¶æ ¹æ®è¿™ä¸ªæœ€å°å€¼åœ¨å½“å‰åŒºé—´æ‰€å‡ºç°çš„ä½ç½®æ¥å°†å½“å‰åŒºé—´æ‹†åˆ†ä¸ºè‹¥å¹²ä¸ªå­åŒºé—´ç»§ç»­è¿›è¡Œåˆ†æ²»ï¼Œå¹¶ä¸”å°† $ans$ çš„å€¼å¢åŠ 1ï¼Œç›´åˆ° $l<r$ å°±å¯ä»¥é€€å‡ºè¯¥é€’å½’å‡½æ•°äº†ã€‚

â€‹æ³¨æ„ï¼Œå½“åŒºé—´çš„æœ€å°å€¼ä¸º0æ—¶ï¼Œ $ans$ çš„å€¼ä¸éœ€è¦å¢åŠ 1ï¼Œå› ä¸ºæ­¤æ—¶ä¸éœ€è¦è¿›è¡Œä¸€æ¬¡å˜æ¢ã€‚

â€‹æ—¶é—´å¤æ‚åº¦ä¸º $O(n\log_2^2n)$ã€‚

### ä»£ç :

```C++
#include<bits/stdc++.h>
#define van long long
#define N 100010
#define ywhin cin
#define ywhout cout
using namespace std;
van n,a[N],tmp[N];
van tree[N*4],ans;
vector<van> place[N];
void build(van p,van l,van r)
{
	if (l==r){tree[p]=a[l];return;}
	van mid=l+r>>1;
	build(p*2,l,mid);build(p*2+1,mid+1,r);
	tree[p]=min(tree[p*2],tree[p*2+1]);
}//æ„å»ºçº¿æ®µæ ‘
van query(van p,van l,van r,van L,van R)
{
	if (L<=l&&r<=R) return tree[p];
	van mid=l+r>>1;
	van x=1e18;
	if (L<=mid) x=min(x,query(p*2,l,mid,L,R));
	if (R>mid) x=min(x,query(p*2+1,mid+1,r,L,R));
	return x;
}//åœ¨çº¿æ®µæ ‘å†…æŸ¥è¯¢æœ€å°å€¼
void solve(van l,van r)
{
	if (l>r) return;
	van min_=query(1,1,n,l,r);//è·å–[l,r]çš„æœ€å°å€¼
	if (tmp[min_]!=0) ans++;//æ³¨æ„:å½“æœ€å°å€¼ä¸º0æ—¶æ˜¯ä¸éœ€è¦ans++çš„
	van ll=0,rr=place[min_].size()-1,lll;
	while (ll<=rr)
	{
		van mid=ll+rr>>1;
		if (place[min_][mid]>=l) lll=mid,rr=mid-1;
		else ll=mid+1;
	}//äºŒåˆ†æŸ¥æ‰¾æœ€å°å€¼æ‰€åœ¨çš„ä½ç½®idæœ€å°çš„ä½ç½®
	ll=0,rr=place[min_].size()-1;van rrr;
	while (ll<=rr)
	{
		van mid=ll+rr>>1;
		if (place[min_][mid]<=r) rrr=mid,ll=mid+1;
		else rr=mid-1;
	}//äºŒåˆ†æŸ¥æ‰¾æœ€å°å€¼æ‰€åœ¨çš„ä½ç½®idæœ€å¤§çš„ä½ç½®
	solve(l,place[min_][lll]-1);//è§£å†³[l,a_l-1]çš„åŒºé—´
	for (int i=lll;i<rrr;i++) solve(place[min_][i]+1,place[min_][i+1]-1);//è§£å†³[a_i+1,a_{i+1}-1]æ‰€åœ¨çš„åŒºé—´
	solve(place[min_][rrr]+1,r);//è§£å†³[a_r+1,r]çš„åŒºé—´
}//åˆ†æ²»è§£å†³é—®é¢˜
int main()
{
//	ifstream ywhin("po.in");
//	ofstream ywhout("po.out");
	ywhin>>n;
	for (int i=1;i<=n;i++) ywhin>>a[i];
	memcpy(tmp,a,sizeof tmp);
	sort(tmp+1,tmp+n+1);
	van cnt=unique(tmp+1,tmp+n+1)-tmp-1;
	for (int i=1;i<=n;i++) a[i]=lower_bound(tmp+1,tmp+cnt+1,a[i])-tmp;//ç¦»æ•£åŒ–
	for (int i=1;i<=n;i++) place[a[i]].push_back(i);//è®°å½•æŸä¸€ä¸ªç¦»æ•£åŒ–åçš„æ•°ä¼šå‡ºç°åœ¨å“ªäº›ä½ç½®
	build(1,1,n);
	solve(1,n);
	ywhout<<ans<<endl;
	return 0;
}
```



## T3 Megenta

### é¢˜ç›®æè¿°:

â€‹å°På’Œå°Måœ¨ç©ä¸€ä¸ªæ¸¸æˆï¼Œæ¸¸æˆçš„å†…å®¹æ˜¯è¿™æ ·çš„ã€‚ 

â€‹æœ‰ä¸€æ£µ $n$ ä¸ªèŠ‚ç‚¹çš„æ ‘ï¼Œæ ‘ä¸Šçš„ $ğ‘›âˆ’1$ æ¡è¾¹ç”±ä¸‰ç§æ ‡è®°ï¼Œåˆ†åˆ«ä¸º $ğ‘šğ‘ğ‘”ğ‘’ğ‘›ğ‘¡ğ‘,ğ‘ğ‘™ğ‘ğ‘£ğ‘,cğ‘Ÿğ‘£ğ‘’ğ‘›ğ‘$ ã€‚æ¸¸æˆå¼€å§‹çš„æ—¶å€™ï¼Œå°Pçš„æ£‹å­ä½äºèŠ‚ç‚¹ $a$ ï¼Œå°Mçš„æ£‹å­ä½äºèŠ‚ç‚¹ $b$ ã€‚æ¸¸æˆå¼€å§‹åï¼Œå°På…ˆè¡ŒåŠ¨ï¼Œä»–éœ€è¦é€‰æ‹©ä¸€æ¡è¾¹ï¼Œä»èŠ‚ç‚¹ $a$ æ²¿ç€è¾¹èµ°åˆ°å¦ä¸€ç«¯ï¼Œè¦æ±‚å°Mçš„æ£‹å­å¦ä¸€ç«¯å¹¶ä¸”è¾¹çš„æ ‡è®°ä¸º $ğ‘ğ‘™ğ‘ğ‘£ğ‘$ æˆ–è€… $ğ‘šğ‘ğ‘”ğ‘’ğ‘›ğ‘¡ğ‘$ ã€‚éšåç”±å°Mæ“ä½œï¼ŒåŒæ ·æ²¿ç€ä¸€æ¡è¾¹èµ°ï¼Œè¦æ±‚å°Pçš„æ£‹å­ä¸åœ¨å¦ä¸€ç«¯ï¼Œè¾¹çš„æ ‡è®°ä¸º $ğ‘ğ‘Ÿğ‘£ğ‘’ğ‘›ğ‘$ æˆ– $ğ‘šğ‘ğ‘”ğ‘’ğ‘›ğ‘¡ğ‘$ ã€‚äºŒäººè½®æµæ“ä½œï¼Œé¦–å…ˆæ— æ³•æ“ä½œçš„äººå¤±è´¥ã€‚ 

â€‹ç°åœ¨ï¼Œæˆ‘ä»¬å‡è®¾äºŒäººéƒ½æ˜¯ç»å¯¹ç†æ€§å’Œèªæ˜çš„ï¼Œè¯·é—®è°ä¼šè·å¾—èƒœåˆ©ã€‚

### è¾“å…¥æè¿°:

â€‹è¾“å…¥çš„ç¬¬ä¸€è¡ŒåŒ…æ‹¬ä¸€ä¸ªæ­£æ•´æ•° $n(1\leq n\leq 10^5)$ ï¼Œè¡¨ç¤ºæ ‘ä¸Šçš„èŠ‚ç‚¹çš„æ•°ç›®ã€‚

â€‹è¾“å…¥çš„ç¬¬äºŒè¡ŒåŒ…æ‹¬ä¸¤ä¸ªæ­£æ•´æ•° $a,b(1\leq a,b\leq n,a\not=b)$ ï¼Œè¡¨ç¤ºæœ€å¼€å§‹å°På’Œå°Mçš„æ£‹å­æ‰€åœ¨çš„ ä½ç½®ã€‚ 

â€‹æ¥ä¸‹æ¥çš„ $n-1$ è¡Œï¼Œæ¯è¡Œçš„æ ¼å¼å¦‚ä¸‹" $x\ y\ signal$ "ã€‚è¡¨ç¤ºè¾¹ $<x,y>$ ä¸Šçš„æ ‡è®°ä¸º $signal$ã€‚$signal\in\{magenta,crvena,plava\}$ã€‚

### è¾“å‡ºæè¿°:

â€‹å¦‚æœå°Pä¼šè·èƒœï¼Œè¾“å‡º" $Paula$ ",å¦‚æœå°Mè·èƒœï¼Œè¾“å‡º" $Marin$ "ã€‚å¦‚æœå¹³å±€ï¼Œè¾“å‡º" $Magenta$ "ã€‚

### åˆ†æ:

#### 30Pts:

â€‹ç”±äºæ¯æ¡è·¯å¯¹äºæ¯ä¸ªäººéƒ½æ˜¯å¯ä»¥èµ°çš„ï¼Œå› æ­¤åªéœ€è¦åˆ¤æ–­ä¸¤ä¸ªäººä¹‹é—´çš„è·ç¦»å°±è¡Œäº†ã€‚

#### 100Pts:

â€‹ä»¤å½“è½®åˆ°è‡ªå·±è¡ŒåŠ¨å‰ä¸å¯¹æ–¹çš„è·ç¦»ä¸ºå¶æ•°çš„ä¸€æ–¹killerï¼Œå¦ä¸€æ–¹ä¸ºloserï¼Œåˆ™killeråªä¼šèµ¢æˆ–å¹³å±€ï¼Œæ¯•ç«Ÿå…¶èµ°ä¸åˆ°å¯¹æ–¹çš„æ£‹å­ä¸Š(å½“killeræ ¹æœ¬æ— æ³•è¡Œèµ°æ—¶ï¼Œè¦æ³¨æ„åˆ¤æ–­)ã€‚

â€‹æœç´¢killerèƒ½èµ°åˆ°çš„è·¯å¾„ï¼Œå¹¶åœ¨è¿™æ¡è·¯å¾„ä¸Šçš„æ¯ä¸€æ¡çˆ¶èŠ‚ç‚¹æ‰©å±•ä»–è¿˜èƒ½åˆ°è¾¾çš„å­èŠ‚ç‚¹æ ‡è®°ä¸º1ï¼Œå†æœç´¢loserèƒ½å¦åˆ°è¾¾è¿™äº›æ ‡è®°ä¸º1çš„ç‚¹ï¼Œå³loserèƒ½å¦æˆåŠŸé€ƒè„±ï¼Œè‹¥loserèƒ½æˆåŠŸé€ƒè„±ï¼Œåˆ™ä¸ºå¹³å±€ï¼Œå¦åˆ™loserè¾“ã€‚

â€‹åˆ†ç±»è®¨è®º:

â€‹1.è‹¥å…ˆæ‰‹æ— å¤„å¯èµ°ï¼Œåæ‰‹èµ¢ã€‚

â€‹2.è‹¥åæ‰‹æ— å¤„å¯èµ°ï¼Œå…ˆæ‰‹èµ¢ã€‚

â€‹3.è‹¥loserèƒ½å¤ŸæˆåŠŸé€ƒè„±ï¼Œå¹³å±€ã€‚

â€‹4.å¦åˆ™killerèµ¢ã€‚

### ä»£ç :

```C++
#include<bits/stdc++.h>
#define van long long
#define N 100010
#define pb push_back
#define mp make_pair
using namespace std;
van n,a,b,fa[N],dis[N],len;
vector<pair<van,van> > graph[N];
bool used1[N],used2[N];
van cnt1,cnt2,killer,loser;
void PutError(string info)
{
	cout<<info;
	exit(0);
}//é”™è¯¯è¾“å‡º
void A(){printf("Paula");exit(0);}//å…ˆæ‰‹èµ¢
void B(){printf("Marin");exit(0);}//åæ‰‹èµ¢
void C(){printf("Magenta");exit(0);}//å¹³å±€
void DFS1(van u,van f)
{
	fa[u]=f;
	for (int i=0;i<graph[u].size();i++) if (graph[u][i].first!=f) DFS1(graph[u][i].first,u);
}//æŸ¥æ‰¾æ¯ä¸ªå­èŠ‚ç‚¹çš„çˆ¶äº²èŠ‚ç‚¹
void DFS2(van u,van f)
{
	cnt1++;
	for (int i=0;i<graph[u].size();i++) if (graph[u][i].first!=f&&graph[u][i].first!=b&&graph[u][i].second!=a) DFS2(graph[u][i].first,u);
}//æŸ¥æ‰¾aèƒ½èµ°çš„ç‚¹
void DFS3(van u,van f)
{
	cnt2++;
	for (int i=0;i<graph[u].size();i++) if (graph[u][i].first!=f&&graph[u][i].second!=b) DFS3(graph[u][i].first,u);
}//æŸ¥æ‰¾bèƒ½èµ°çš„ç‚¹
void DFS4(van u,van f,van step)
{
	dis[u]=step;cnt1++;used1[u]=1;
	for (int i=0;i<graph[u].size();i++) if (graph[u][i].first!=f&&graph[u][i].second!=killer) DFS4(graph[u][i].first,u,step+1);
}//æœç´¢killerèƒ½èµ°åˆ°çš„ç‚¹
void DFS5(van u,van f,van step)
{
	if (used2[u]) C();
	for (int i=0;i<graph[u].size();i++) if (graph[u][i].first!=f&&graph[u][i].second!=loser&&step+1-(loser==a)<dis[graph[u][i].first]) DFS5(graph[u][i].first,u,step+1);
}//æœç´¢loserèƒ½èƒ½å¦é€ƒè„±
int main()
{
	scanf("%lld\n%lld%lld",&n,&a,&b);
	for (int i=1;i<n;i++)
	{
		van f,s;string w;
		scanf("%lld%lld",&f,&s);cin>>w;
		van weight=112700;
		if (w[0]=='m') weight=0;
		else if (w[0]=='p') weight=b;
		else if (w[0]=='c') weight=a;
		else PutError("Input Error!");
		graph[f].pb(mp(s,weight));
		graph[s].pb(mp(f,weight));
	}//åŠ è¾¹
	DFS1(1,0);
	for (int i=a;i;i=fa[i])
	{
		used1[i]=1;
		dis[fa[i]]=dis[i]+1;
	}
	if (used1[b]) len=dis[b];
	else for (int i=b;i;i=fa[i])
	{
		if (used1[fa[i]])
		{
			len=dis[i]+dis[fa[i]]+1;
			break;
		}
		dis[fa[i]]=dis[i]+1;
	}
	killer=len%2?b:a,loser=len%2?a:b;//æŸ¥æ‰¾killerä¸loser
	for (int i=1;i<=n;i++) used1[i]=0,dis[i]=1e18;
	DFS2(a,0);if (cnt1==1) B();
	DFS3(b,0);if (cnt2==1) A();
	DFS4(killer,0,0);
	for (int i=1;i<=n;i++) if (!used1[i])
	{
		for (int j=0;j<graph[i].size();j++) if (!used1[graph[i][j].first]&&graph[i][j].second!=loser)
		{
			used2[i]=1;
			break;
		}
	}
	DFS5(loser,0,0);
	if (killer==a) A();else B();//loseræ— æ³•é€ƒè„±
	return 0;
}
```



## T4 Planine

### é¢˜ç›®æè¿° :

â€‹å‹‡è€…å°ğ‘è¦è·¨è¶Šç²¾çµå±±è„‰å¯»æ‰¾é—è½çš„ç²¾çµç§˜å®ã€‚ç²¾çµå±±è„‰å¯ä»¥ç”¨ä¸€ä¸ªé•¿ä¸ºå¥‡æ•°çš„åæ ‡åºåˆ—è¡¨ç¤ºï¼Œå¦‚æœæˆ‘ä»¬å°†è¿™äº›ç‚¹çš„åæ ‡æŒ‰ç…§ $x$ åæ ‡æ’åºï¼Œé™¤å»ç¬¬ä¸€ä¸ªç‚¹å’Œæœ€åä¸€ä¸ªç‚¹ä¹‹å¤–çš„å¥‡æ•°ç¼–å·çš„ç‚¹çš„ $y$ åæ ‡è¡¨ç¤º**å±±è°·**çš„é«˜åº¦ï¼Œå¶æ•°ç¼–å·çš„ç‚¹è¡¨ç¤º**å±±é¡¶**çš„åæ ‡ã€‚æ˜¾ç„¶ï¼Œå±±è°·çš„é«˜åº¦ä¸€å®šæ¯”æ—è¾¹çš„ä¸¤ä¸ªå±±é¡¶çš„é«˜åº¦ä½ã€‚ 

â€‹å‹‡è€…å°ğ‘æƒ§æ€•é»‘æš—ï¼Œå¥½åœ¨ç²¾çµå±±è„‰å†…æœ‰ç€å¯ä»¥ç…§æ˜çš„ç²¾çµï¼Œè¿™äº›ç²¾çµå›ºå®šåœ¨é«˜åº¦ä¸º$h$çš„åœ°æ–¹ï¼Œ ä¸€ä¸ªç²¾çµå¯ä»¥ç…§äº®ä¸€åº§å±±è°·ï¼Œå½“ä¸”ä»…å½“**è¯¥ç²¾çµä¸è¿™åº§å±±è°·çš„è¿çº¿ä¸ä¼šä¸å±±è„‰ç›¸äº¤**ã€‚

â€‹ä½ çš„ä»»åŠ¡æ˜¯æ±‚å‡ºï¼Œæœ€å°‘éœ€è¦å¤šå°‘åªç²¾çµçš„å¸®åŠ©æ‰èƒ½å¤Ÿç…§äº®æ‰€æœ‰å±±è°·ï¼Œè®©å°ğ‘ç©¿è¶Šç²¾çµå±±è„‰ã€‚

### è¾“å…¥æè¿°:

â€‹è¾“å…¥çš„ç¬¬ä¸€è¡ŒåŒ…æ‹¬ä¸¤ä¸ªæ­£æ•´æ•° $n(3\leq n\leq 10^6)$ï¼Œ$n$ æ˜¯ä¸€ä¸ªå¥‡æ•°å’Œæ­£æ•´æ•° $h(1\leq h\leq 106)$ åˆ†åˆ«æè¿°ç²¾çµå±±è„‰ä»¥åŠç…§æ˜ç²¾çµçš„é«˜åº¦ã€‚ 

â€‹æ¥ä¸‹æ¥çš„ğ‘›è¡Œï¼Œç¬¬ğ‘–è¡ŒåŒ…æ‹¬ä¸¤ä¸ªæ•´æ•° $x_i$ å’Œ $y_i(-10^6\leq x_i\leq 10^6,0\leq y_i<h)$ï¼Œè¡¨ç¤ºæè¿°å±±è„‰çš„ç¬¬ ğ‘–ä¸ªç‚¹çš„åæ ‡ã€‚ 

â€‹è¾“å…¥ä¿è¯ $x_1<x_2<...<x_n$ï¼Œå¹¶ä¸” $y_1<y_2,y_2>y_3,y_3<y_4...y_{n-1}>y_n$ã€‚

### è¾“å‡ºæè¿°:

â€‹è¾“å‡ºæœ€å°‘çš„ï¼Œç…§äº®æ‰€æœ‰å±±è°·æ‰€éœ€è¦çš„ç…§æ˜ç²¾çµçš„æ•°ç›®ã€‚

### åˆ†æ:

#### 20Pts:

â€‹ç”±äºè¿™ä¸€æ¡£çš„å±±é¡¶çš„é«˜åº¦éƒ½ç›¸åŒï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦é€šè¿‡æ˜ å°„ä¸€åªç²¾çµèƒ½å¤Ÿç…§äº®æŸä¸€ä¸ªå±±è°·æ‰€éœ€è¦æ”¾ç½®çš„èŒƒå›´ï¼Œç„¶åç”¨ä¸€ä¸ªè´ªå¿ƒå°±å¯ä»¥é€šè¿‡æ­¤é¢˜ã€‚

â€‹è´ªå¿ƒç­–ç•¥:

â€‹è®¾ç¬¬$i$ä¸ªå±±è°·æ˜ å°„åçš„èŒƒå›´ä¸º$[l_i,r_i]$ï¼Œå·²ç»å®‰æ”¾çš„æœ€åä¸€åªç²¾çµçš„åæ ‡ä¸º$(pos,h)$ï¼Œ$pos=-\infty$ ï¼ŒæŒ‰ç…§æ¯ä¸ªèŒƒå›´çš„å·¦ç«¯ç‚¹ $l_i$ ä»å°åˆ°å¤§æ’åºã€‚

â€‹ä¾æ¬¡è€ƒè™‘æ¯ä¸ªåŒºé—´ï¼Œè‹¥ $l_i>pos$ï¼Œåˆ™åœ¨ $r_i$ çš„ä½ç½®ä¸Šæ–°å¢ä¸€åªç²¾çµã€‚å¦åˆ™å°±å°†æœ€åçš„é‚£ä¸€åªç²¾çµä» $pos$ æ”¾ç½®åˆ° $\min(pos,r_i)$ã€‚

#### 50Pts:

â€‹æ­¤æ¡£æ•°æ®é‡ $n\leqslant 2000$ï¼Œåœ¨ $n^2$ çš„æ—¶é—´å¤æ‚åº¦èƒ½å¤Ÿé€šè¿‡æ­¤é¢˜ï¼Œå› æ­¤åœ¨æ‰§è¡Œè´ªå¿ƒæ“ä½œä¹‹å‰ä½¿ç”¨ $n^2$ çš„æ—¶é—´å¤æ‚åº¦æ‰¾åˆ°ä¸ä¼šè¢«æŒ¡ä½çš„å±±é¡¶çš„ç¼–å·ä»¥åŠæ˜ å°„åˆ°çš„ä½ç½®å³å¯ã€‚

#### 100Pts:

â€‹åœ¨æŸç›¸é‚»ä¸¤ä¸ªå±±é¡¶ä¸­é—´è¿ä¸€æ¡çº¿(å¦‚ä¸‹å›¾æ‰€ç¤º)ï¼Œåœ¨è¿™æ¡çº¿æ‰€åœ¨çš„ç›´çº¿ä¸Šæ–¹çš„æ‰€æœ‰å±±è°·ä¸ä¸Šæ–¹çš„å±±é¡¶çš„è¿çº¿éƒ½ä¼šæ¯”ä¸ä¸‹æ–¹å±±é¡¶çš„è¿çº¿æ›´ä¼˜ï¼Œå› æ­¤å…¶å³ä¸Šæ–¹çš„å±±è°·ä¼šå°†ä¸‹æ–¹å±±é¡¶ç»™è¸¢æ‰ï¼Œæœ€åå½¢æˆçš„ä¼šæ˜¯ä¸€ä¸ªä¸Šå‡¸å£³ï¼Œä»å·¦å¾€å³ä»¥åŠä»å³å¾€å·¦å„æ‰«ä¸€éä¹‹åå°±èƒ½æ‰¾åˆ°å¯¹äºæ¯ä¸ªå±±è°·æ‰€æ˜ å°„çš„ä½ç½®ï¼Œç„¶åæ ¹æ®è´ªå¿ƒç­–ç•¥è§£å†³æ­¤é—®é¢˜å³å¯ã€‚

![image-20210817203120771](./T4-åˆ†æ-100Pts-1.jpg)

### ä»£ç :

```C++
#include<bits/stdc++.h>
#define van long long
#define N 1000100
#define ywhin cin
#define ywhout cout
using namespace std;
struct node
{
	van x,y;
}pts[N];//å­˜å‚¨è¾“å…¥çš„ç‚¹
struct node2
{
	double l,r;
}area[N];//å­˜å‚¨å±±è°·æ‰€æ˜ å°„åˆ°hçš„åŒºé—´
van p[N],l=1,r=0;
van L[N],R[N];
van n,h,cnt,ans;
double calc(node a,node b)
{
	double dertax=b.x-a.x,dertay=b.y-a.y;
	return dertay/dertax;
}//è®¡ç®—æ–œç‡
bool cmp(node2 a,node2 b)
{
	if (a.l==b.l) return a.r<b.r;
	return a.l<b.l;
}//æ¯”è¾ƒå‡½æ•°
int main()
{
 	scanf("%lld %lld",&n,&h);
	for (int i=1;i<=n;i++) scanf("%lld %lld",&pts[i].x,&pts[i].y);
	for (int i=2;i<=n-1;i++)//æ­£ç€æ‰«ä¸€é
	{
		if (!(i%2))
		{
			while (l<r&&calc(pts[p[r-1]],pts[p[r]])<=calc(pts[p[r]],pts[i])) r--;//æ³¨æ„:è¿™é‡Œä¸åŠ ç­‰äºå·ä¼šTLE 
			p[++r]=i;
			while (r==l+1&&pts[p[l]].y<pts[p[r]].y) l++;
		}//å±±é¡¶è¸¢å±±é¡¶(ç»´æŠ¤å‡¸å£³)
		else
		{
			double min_k=1e18,now=-1;
			for (int j=l;j<=r;j++)
			    if (now==-1||calc(pts[p[j]],pts[i])<min_k) min_k=calc(pts[p[j]],pts[i]),now=p[j];
			L[i]=now;
		}//æŸ¥æ‰¾å¯¹äºå½“å‰å±±è°·æ¥è¯´æœ€é«˜çš„å·¦è¾¹çš„å±±é¡¶çš„ç¼–å·
	}
	l=1,r=0;
	for (int i=n-1;i>=2;i--)//åç€æ‰«ä¸€é
	{
		if (!(i%2))
		{
			while (l<r&&calc(pts[p[r]],pts[p[r-1]])>=calc(pts[i],pts[p[r]])) r--;//æ³¨æ„:è¿™é‡Œä¸åŠ ç­‰äºå·ä¼šTLE
			p[++r]=i;
			while (r==l+1&&pts[p[r]].y<pts[p[l]].y) l++;
		}//å±±é¡¶è¸¢å±±é¡¶(ç»´æŠ¤å‡¸å£³)
		else
		{
			double min_k=1e18,now=-1;
			for (int j=l;j<=r;j++)
			    if (now==-1||calc(pts[p[j]],pts[i])>min_k) min_k=calc(pts[p[j]],pts[i]),now=p[j];
			R[i]=now;
		}//æŸ¥æ‰¾å¯¹äºå½“å‰å±±è°·æ¥è¯´æœ€é«˜çš„å³è¾¹çš„å±±é¡¶çš„ç¼–å·
	}
	for (int i=3;i<=n-2;i+=2)
	{
		area[++cnt].l=(double)pts[i].x-(double)(h-pts[i].y)/(pts[L[i]].y-(double)pts[i].y)*(double)(pts[i].x-pts[L[i]].x);
		area[cnt].r=(double)pts[i].x+(double)(h-pts[i].y)/(pts[R[i]].y-(double)pts[i].y)*(double)(pts[R[i]].x-pts[i].x);
	}//è®¡ç®—å½“å‰å±±è°·æ‰€æ˜ å°„åˆ°hçš„åŒºé—´
	double pos=-1e9;
	sort(area+1,area+cnt+1,cmp);
	for (int i=1;i<=cnt;i++)
	{
		if (area[i].l>pos) ans++,pos=area[i].r;
		else pos=min(pos,area[i].r);
	}//è´ªå¿ƒè®¡ç®—æœ€å°å€¼
	cout<<ans<<endl;
	return 0;
}
```



## T5 Sjeckanje

### é¢˜ç›®æè¿°:

â€‹ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„åºåˆ— $a_i$ã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåºåˆ—çš„åˆ’åˆ†æ˜¯å°†ä¸€ä¸ªåºåˆ—åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªåŒºé—´ï¼Œè¿™ äº›åŒºé—´ä¾æ¬¡è¿æ¥èµ·æ¥å°±å¯ä»¥è¿˜åŸæ•´ä¸ªåºåˆ—ã€‚ä¾‹å¦‚ï¼šåŒºé—´[1 3]\[1 4][3 6]å°±æ˜¯åºåˆ—1 3 1 4 3 6çš„ä¸€ä¸ª åˆæ³•åˆ’åˆ†ã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåŒºé—´çš„æƒå€¼ä¸º**åŒºé—´å†…çš„æœ€å¤§å€¼å‡å»åŒºé—´å†…çš„æœ€å°å€¼ã€‚å®šä¹‰åœ¨è¿™ä¸ªåŒºé—´åˆ’åˆ†ä¸‹ï¼Œåºåˆ—çš„æƒå€¼ä¸ºå„ä¸ªåŒºé—´çš„æƒå€¼çš„å’Œã€‚**

â€‹ä¾‹å¦‚ï¼šåœ¨åŒºé—´åˆ’åˆ†[1 3]\[1 4][3 6]çš„æƒ…å†µä¸‹ï¼Œåºåˆ—çš„æƒå€¼ä¸º $(3-1)+(4-1)+(6-3)=9$ã€‚ 

â€‹ä½ çš„ä»»åŠ¡æ˜¯ï¼šæ±‚å‡ºåºåˆ— $a_i$ æƒå€¼æœ€å¤§çš„åŒºé—´åˆ’åˆ†æ‰€å¯¹åº”çš„åºåˆ—æƒå€¼ã€‚ 

â€‹éœ€è¦æ”¯æŒ $q$ æ¬¡ä¿®æ”¹æ“ä½œï¼Œä¿®æ”¹æ“ä½œå½¢å¼å¦‚ä¸‹:å°†ä¸‹æ ‡åŒºé—´[ $l,r$ ]ä¸­çš„ $a_i$ åŠ ä¸Š $x$ ã€‚ä½ éœ€è¦åœ¨æ¯ä¸€æ¬¡ä¿®æ”¹æ“ä½œä¹‹åï¼Œè¾“å‡ºæ–°çš„åºåˆ—çš„æƒå€¼æœ€å¤§çš„åŒºé—´åˆ’åˆ†æ‰€å¯¹åº”çš„æƒå€¼ã€‚

### è¾“å…¥æè¿°:

â€‹è¾“å…¥çš„ç¬¬ä¸€è¡ŒåŒ…æ‹¬ä¸¤ä¸ªæ•´æ•° $n$ å’Œ $q(1\leq n,q\leq 2\times10^5)$ï¼Œåˆ†åˆ«è¡¨ç¤ºåºåˆ—çš„é•¿åº¦å·²ç»æ›´æ–°æ“ä½œçš„æ¬¡æ•°ã€‚ ç¬¬äºŒè¡ŒåŒ…å« $n$ ä¸ªæ•´æ•° $a_i(-10^8\leq a_i\leq 10^8)$ï¼Œè¡¨ç¤ºåºåˆ—çš„åˆå€¼ $a_i$ã€‚ æ¥ä¸‹æ¥çš„ $q$ è¡Œï¼Œæ¯è¡ŒåŒ…æ‹¬ä¸‰ä¸ªæ•´æ•° $l,r(1\leq l\leq r\leq n)$ å’Œ $x(-10^8\leq x\leq 10^8)$ï¼Œæè¿°ä¸€ä¸ªä¿®æ”¹æ“ä½œã€‚

### è¾“å‡ºæè¿°:

â€‹è¾“å‡º $q$ è¡Œï¼Œæ¯è¡Œä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ¯ä¸€æ¬¡æ›´æ–°æ“ä½œä¹‹ååºåˆ—æœ€å¤§çš„å¯èƒ½çš„åŒºé—´åˆ’åˆ†çš„æƒå€¼ã€‚

### åˆ†æ:

#### 30pts:

â€‹ä»¤ $dp_i$ ä¸ºå¯¹äºå‰ $i$ ä¸ªæ•°æ®çš„åŒºé—´èƒ½å–åˆ°çš„æœ€å¤§æƒå€¼ï¼Œåˆ™ $dp_{i+j}=dp_i+a_{max}-a_{min}$ã€‚

â€‹è€Œå¯¹äºåŒºé—´ä¿®æ”¹ï¼Œforå¾ªç¯ä¸€ä¸ªä¸€ä¸ªåœ°åŠ å°±è¡Œäº†ï¼Œæ—¶é—´å¤æ‚åº¦å°±åªæœ‰ $O(qn)$ã€‚

â€‹æ€»æ—¶é—´å¤æ‚åº¦ $O(qn^2)$ã€‚

#### 60pts:	

â€‹æœ€çŸ­è·¯ä¼˜åŒ–ï¼Œå°†éå•è°ƒåŒºé—´æ‹†åˆ†æˆè‹¥å¹²ä¸ªå•è°ƒåŒºé—´ï¼Œä½¿å¾—æœ€ç»ˆç­”æ¡ˆä¸€å®šä¸åŠ£ã€‚

â€‹ä»¤ $d_i$ ä¸º $a_i$ ä¸ $a_{i-1}$ çš„å·®å€¼ï¼Œåˆ™ $d_i=a_i-a_{i-1}\ \&\ d_1=0$ã€‚

â€‹è‹¥å¯¹äºåŒºé—´ $[l,r]$ï¼Œä½¿å¾— $d_{l+1},d_{l+2},...,d_r$ çš„ç¬¦å·ä¸€å®šæ˜¯ä¸€æ ·çš„ï¼Œåˆ™å½“å‰åŒºé—´$[l,r]$æ‰€èƒ½æä¾›çš„å¯¹ç­”æ¡ˆçš„è´¡çŒ®ä¸º $\sum_{l+1}^r|d_i|$ã€‚

â€‹æ—¶é—´å¤æ‚åº¦ä¸º $O(qn)$ã€‚

#### 100pts:

â€‹å¼•å…¥çº¿æ®µæ ‘è¿›è¡Œç»´æŠ¤ï¼Œè®°å½•çº¿æ®µæ ‘èŠ‚ç‚¹ $T[x][0/1][0/1]$ï¼Œè¡¨ç¤ºçº¿æ®µæ ‘èŠ‚ç‚¹ä¸º$x$æ‰€ä»£è¡¨çš„åŒºé—´èƒ½å–åˆ°çš„åŒºé—´æœ€å€¼ã€‚

â€‹åé¢çš„ä¸¤ä¸ª0/1åˆ†åˆ«è¡¨ç¤ºå·¦ç«¯ç‚¹çš„ $d_i$ å–è¿˜æ˜¯ä¸å–ï¼Œä»¥åŠå³ç«¯ç‚¹ $d_i$ å–è¿˜æ˜¯ä¸å–ã€‚

â€‹ä¿®æ”¹æ—¶åªéœ€è¦ä¿®æ”¹æ‰€éœ€è¦ä¿®æ”¹çš„åŒºé—´çš„å·¦ç«¯ç‚¹ä»¥åŠå³ç«¯ç‚¹ç„¶åæ›´æ–°åˆ°çº¿æ®µæ ‘ä¸Šå³å¯ã€‚

â€‹æ—¶é—´å¤æ‚åº¦ä¸º $O(qlog_2n)ã€‚$

### ä»£ç :

```C++
#include<bits/stdc++.h>
#define van long long
#define N 1000100
using namespace std;
van n,a[N],q,d[N];
van t[N*4][2][2];//çº¿æ®µæ ‘
void update(van p,van num)
{
	for (int i=0;i<2;i++) for (int j=0;j<2;j++)
	{
		t[p][i][j]=-1e18;
		for (int k=0;k<2;k++) for (int l=0;l<2;l++) if (l!=1||k!=1||d[num]*d[num+1]>=0) t[p][i][j]=max(t[p][i][j],t[p*2][i][k]+t[p*2+1][l][j]);
	}
}//æ›´æ–°çº¿æ®µæ ‘pèŠ‚ç‚¹ä¸Šçš„å€¼
void add(van p,van l,van r,van where)
{
	if (l==r)
	{
//		cout<<"add "<<l<<" "<<d[l]<<endl;
		t[p][1][1]=abs(d[l]);
		return;
	}
	van mid=l+r>>1;
	if (where<=mid) add(p*2,l,mid,where);
	if (where>mid) add(p*2+1,mid+1,r,where);
	update(p,mid);
}//æ›´æ–°çº¿æ®µæ ‘(å•ç‚¹ä¿®æ”¹)
van query(van x)
{
	return max(t[x][0][0],max(t[x][0][1],max(t[x][1][0],t[x][1][1])));
}//æŸ¥è¯¢çº¿æ®µæ ‘ä¸ŠxèŠ‚ç‚¹çš„æœ€å¤§å€¼
int main()
{
//	ifstream ywhin("sjeckanje.in");
//	ofstream ywhout("sjeckanje.out");
	#define ywhin cin
	#define ywhout cout
	ywhin>>n>>q;
	for (int i=1;i<=n;i++) ywhin>>a[i];
	for (int i=1;i<=n;i++) d[i]=i==1?0:a[i]-a[i-1],add(1,1,n,i);//å·®åˆ†å¹¶æ’å…¥çº¿æ®µæ ‘ä¸Š
	while (q--)
	{
		van l,r,k;
		ywhin>>l>>r>>k;
		if (l!=1)
		{
			d[l]+=k;
			add(1,1,n,l);
		}//æ·»åŠ å·¦ç«¯ç‚¹
		if (r!=n)
		{
			d[r+1]-=k;
			add(1,1,n,r+1);
		}//æ·»åŠ å³ç«¯ç‚¹
		cout<<query(1)<<endl;//æŸ¥è¯¢[1,n]çš„åŒºé—´æœ€å€¼
	}
	return 0;
}
```
